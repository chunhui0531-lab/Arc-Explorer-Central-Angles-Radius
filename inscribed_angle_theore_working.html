<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åœ“å‘¨è§’å®šç†äº’å‹•è­‰æ˜ç³»çµ±</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Urbanist:wght@400;600;700&family=Noto+Sans+TC:wght@400;500;700&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* å¹¾ä½•æº«æš–é…è‰² */
            --primary: #FF6B6B;
            --secondary: #4ECDC4;
            --accent: #FFE66D;
            --dark: #2D3142;
            --light: #F8F9FA;
            --success: #51CF66;
            --locked: #ADB5BD;

            /* å­—é«”ç³»çµ± */
            --font-display: 'Urbanist', sans-serif;
            --font-body: 'Noto Sans TC', sans-serif;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: var(--font-body);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            margin: 0;
            overflow: hidden;
            box-sizing: border-box;
        }

        .container {
            background: white;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            width: 100%;
            max-width: 1400px;
            height: 90vh;
            max-height: 900px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }

        /* é ç±¤å°èˆª */
        .tabs {
            display: flex;
            background: var(--dark);
            padding: 8px;
            gap: 8px;
            flex-shrink: 0;
        }

        .tab-button {
            flex: 1;
            padding: 16px 24px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.1);
            color: rgba(255, 255, 255, 0.9);
        }

        .tab-button.active {
            background: white;
            color: var(--dark);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* å…§å®¹å€åŸŸ */
        .tab-content {
            display: none;
            flex: 1;
            overflow: hidden;
        }

        .tab-content.active {
            display: flex;
        }

        /* æ°´å¹³é›™æ¬„å¸ƒå±€ */
        .split-layout {
            display: flex;
            height: 100%;
            width: 100%;
            overflow: hidden;
        }

        .canvas-area {
            flex: 4;
            /* Left 4 */
            background: linear-gradient(135deg, #f5f7fa 0%, #e9ecef 100%);
            padding: 10px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            min-width: 0;
            overflow: hidden;
            box-sizing: border-box;
            position: relative;
        }

        /* Special positioning for Tab A controls */
        #tab1 .controls {
            position: absolute;
            top: 15px;
            right: 15px;
            width: auto;
            gap: 8px;
            z-index: 10;
        }

        #tab1 .controls .btn {
            width: auto;
            padding: 6px 12px;
            font-size: 11px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        /* Special positioning for Tab B controls */
        #tab2 .angle-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            width: auto;
            display: flex;
            gap: 6px;
            margin: 0;
            z-index: 10;
            grid-template-columns: none;
        }

        #tab2 .angle-btn {
            padding: 5px 10px;
            font-size: 12px;
            border-width: 1px;
            border-radius: 8px;
        }

        #tab2 .controls {
            position: absolute;
            top: 55px;
            right: 15px;
            width: auto;
            z-index: 10;
        }

        #tab2 .controls .btn {
            width: auto;
            padding: 6px 12px;
            font-size: 11px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .info-area {
            flex: 3;
            /* Right 3 */
            background: white;
            padding: 20px;
            overflow-y: auto;
            overflow-x: hidden;
            border-left: 2px solid #e9ecef;
            min-width: 320px;
            box-sizing: border-box;
        }

        /* ç¾åŒ–æ»¾å‹•æ¢ */
        .info-area::-webkit-scrollbar {
            width: 6px;
        }

        .info-area::-webkit-scrollbar-track {
            background: transparent;
        }

        .info-area::-webkit-scrollbar-thumb {
            background: #dee2e6;
            border-radius: 3px;
        }

        .info-area::-webkit-scrollbar-thumb:hover {
            background: #adb5bd;
        }

        /* --- Tab B å°ˆå±¬æ¨£å¼ --- */
        #tab2 .info-area {
            /* Follow global layout 4:3 */
        }

        /* --- Tab C å°ˆå±¬æ¨£å¼ --- */
        #tab3 .split-layout {
            justify-content: center;
        }


        #tab3 .info-area {
            flex: 3;
            max-width: none;
        }

        #tab3 .canvas-area {
            flex: 4;
            max-width: none;
        }

        #tab3 .canvas-container {
            max-height: 420px;
        }

        #tab3 canvas {
            max-width: 100%;
            max-height: 400px;
        }

        #tab2 .canvas-area {
            /* Inherit global 4:3 layout */
        }

        /* Tab B å°ˆå±¬å•ç­”æ¨£å¼ */
        #tab2 .radio-group {
            display: flex;
            gap: 12px;
            justify-content: space-between;
            flex-wrap: wrap;
            margin-top: 6px;
        }

        #tab2 .radio-item {
            display: flex;
            align-items: center;
            gap: 6px;
            min-width: 90px;
            font-size: 13px;
            color: #555;
            cursor: pointer;
        }

        #tab2 .radio-item input[type="radio"] {
            margin: 0;
            accent-color: var(--primary);
            cursor: pointer;
        }

        /* -------------------- */

        /* Canvas å®¹å™¨ */
        .canvas-container {
            flex: 1;
            background: white;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        canvas {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            touch-action: none;
            cursor: grab;
            display: block;
        }

        canvas:active {
            cursor: grabbing;
        }

        /* æ§åˆ¶æŒ‰éˆ• */
        .controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 8px 12px;
            border: none;
            border-radius: 10px;
            font-family: var(--font-body);
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 107, 107, 0.4);
        }

        .btn-secondary {
            background: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background: #45b8b0;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #40c057;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(81, 207, 102, 0.4);
        }

        .btn-locked {
            background: var(--locked);
            color: white;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-locked:hover {
            transform: none;
        }

        /* è³‡è¨Šå¡ç‰‡ */
        .info-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #ffffff 100%);
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 12px;
            border-left: 4px solid var(--primary);
        }

        .info-card p {
            margin: 0;
            padding: 0;
            font-size: 20px;
            line-height: 1.5;
            color: #495057;
        }

        .info-title {
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .data-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            font-size: 13px;
            color: #495057;
        }

        .data-value {
            font-family: 'Courier New', monospace;
            font-size: 16px;
            font-weight: 700;
            color: var(--primary);
        }

        /* è¼¸å…¥æ¡† */
        textarea,
        input[type="text"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-family: var(--font-body);
            font-size: 14px;
            resize: vertical;
            transition: all 0.3s ease;
        }

        textarea:focus,
        input[type="text"]:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 0 0 3px rgba(78, 205, 196, 0.1);
        }

        textarea {
            min-height: 80px;
            max-height: 120px;
        }

        /* æµ®å‹•çµè«–å¡ç‰‡ */
        .conclusion-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .conclusion-overlay.show {
            display: flex;
        }

        .conclusion-card {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 600px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.4s ease;
        }

        .conclusion-header {
            font-family: var(--font-display);
            font-size: 36px;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 24px;
            text-align: center;
        }

        .conclusion-content {
            font-size: 24px;
            line-height: 1.8;
            color: #495057;
            margin-bottom: 24px;
        }

        .conclusion-highlight {
            background: linear-gradient(135deg, #fff5f5 0%, #ffe3e3 100%);
            border-left: 4px solid var(--primary);
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            font-weight: 500;
        }

        /* ç‰¹æ®Šè§’æŒ‰éˆ•çµ„ */
        .angle-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin-bottom: 20px;
        }

        .angle-btn {
            padding: 16px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-family: var(--font-display);
            font-size: 24px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--dark);
        }

        .angle-btn:hover {
            border-color: var(--secondary);
            background: rgba(78, 205, 196, 0.1);
        }

        .angle-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.4);
        }

        /* æ­¥é©Ÿå¡ç‰‡ */
        .step-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .step-card p {
            margin: 8px 0;
            font-size: 20px;
            line-height: 1.5;
            color: #495057;
        }

        .step-card strong {
            display: block;
            margin-top: 10px;
            margin-bottom: 6px;
            font-size: 20px;
            color: var(--dark);
        }

        .step-card.locked {
            opacity: 0.5;
            pointer-events: none;
        }

        .step-card.active {
            border-color: var(--secondary);
            box-shadow: 0 4px 12px rgba(78, 205, 196, 0.2);
        }

        .step-card.completed {
            border-color: var(--success);
            background: rgba(81, 207, 102, 0.05);
        }

        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
        }

        .step-number {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            background: var(--secondary);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-family: var(--font-display);
            font-size: 14px;
        }

        .step-card.locked .step-number {
            background: var(--locked);
        }

        .step-card.completed .step-number {
            background: var(--success);
        }

        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        /* å¡«ç©ºé¡Œ */
        .blank-input {
            display: inline-block;
            width: 80px;
            padding: 6px 12px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-family: var(--font-body);
            font-size: 16px;
            font-weight: 700;
            text-align: center;
            color: var(--dark);
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
        }

        .blank-input:focus {
            outline: none;
            border-color: var(--secondary);
            box-shadow: 0 4px 10px rgba(78, 205, 196, 0.2);
            transform: translateY(-1px);
        }

        .blank-input.correct {
            border-color: var(--success);
            background: rgba(81, 207, 102, 0.1);
        }

        .blank-input.incorrect {
            border-color: var(--primary);
            background: rgba(255, 107, 107, 0.1);
            animation: shake 0.5s ease;
        }

        /* é—œå¡é¸æ“‡ */
        .case-selector {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .case-btn {
            flex: 1;
            padding: 10px 8px;
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-family: var(--font-body);
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            line-height: 1.3;
        }

        .case-btn:hover:not(.locked) {
            border-color: var(--secondary);
            background: rgba(78, 205, 196, 0.1);
        }

        .case-btn.active {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }

        .case-btn.locked {
            opacity: 0.4;
            cursor: not-allowed;
        }

        /* å‹•ç•« */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-10px);
            }

            75% {
                transform: translateX(10px);
            }
        }

        /* æç¤ºæ–‡å­— */
        .hint {
            font-size: 18px;
            color: #868e96;
            font-style: italic;
            margin-top: 6px;
        }

        /* å‹¾é¸æ¡† */
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            margin: 6px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: #e9ecef;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-item label {
            flex: 1;
            cursor: pointer;
            font-size: 20px;
        }

        /* æ¢ç´¢è¨ˆæ•¸å™¨ */
        .explore-counter {
            text-align: center;
            padding: 10px;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe3e3 100%);
            border-radius: 10px;
            font-weight: 600;
            font-size: 20px;
            color: var(--primary);
            margin-bottom: 12px;
        }

        input[type="text"].inline-input {
            width: auto;
            min-width: 80px;
            max-width: 120px;
            display: inline-block;
            padding: 4px 12px;
            margin: 0 6px;
            background: white;
            border: 2px solid #e9ecef;
            border-bottom: 2px solid #e9ecef;
            border-radius: 20px;
            text-align: center;
            font-family: var(--font-body);
            font-size: 22px;
            color: var(--dark);
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.03);
            vertical-align: middle;
        }

        input[type="text"].inline-input:focus {
            outline: none;
            border-color: var(--secondary);
            background: white;
            box-shadow: 0 4px 10px rgba(78, 205, 196, 0.2);
            transform: translateY(-1px);
        }

        input[type="text"].inline-input.visited {
            border-color: var(--primary);
        }

        .question-item {
            margin-bottom: 16px;
            font-size: 22px;
            line-height: 2;
            color: #495057;
        }

        .hint-text {
            font-size: 16px;
            color: #868e96;
            margin-left: 4px;
        }

        .inline-input:focus {
            outline: none;
            border-bottom-color: var(--primary);
        }

        .observation-panel {
            opacity: 0.5;
            pointer-events: none;
            transition: all 0.3s ease;
        }

        .observation-panel.unlocked {
            opacity: 1;
            pointer-events: auto;
        }

        /* ===== éŸ¿æ‡‰å¼è¨­è¨ˆ ===== */

        /* å¹³æ»‘æ»¾å‹• */
        html {
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        /* è§¸æ§å„ªåŒ– */
        * {
            -webkit-tap-highlight-color: transparent;
        }

        /* å¹³æ¿è£ç½® (768px - 1024px) */
        @media screen and (max-width: 1024px) {
            body {
                padding: 10px;
            }

            .container {
                height: 95vh;
                max-height: none;
                border-radius: 16px;
            }

            .tabs {
                padding: 6px;
                gap: 4px;
            }

            .tab-button {
                padding: 12px 16px;
                font-size: 20px;
            }

            .split-layout {
                flex-direction: column;
            }

            .canvas-area {
                flex: none;
                height: 45vh;
                min-height: 300px;
                padding: 8px;
            }

            .info-area {
                flex: 1;
                min-width: auto;
                border-left: none;
                border-top: 2px solid #e9ecef;
                padding: 16px;
                overflow-y: auto;
            }

            .case-selector {
                flex-wrap: wrap;
            }

            .case-btn {
                flex: 1 1 30%;
                min-width: 100px;
                font-size: 14px;
                padding: 10px 8px;
            }

            .step-card {
                padding: 14px;
            }

            .step-card p {
                font-size: 18px;
            }

            .btn {
                padding: 14px 20px;
                font-size: 18px;
                min-height: 48px;
            }

            input[type="text"].inline-input {
                font-size: 20px;
                padding: 10px 14px;
                min-height: 48px;
            }

            .checkbox-item {
                padding: 14px;
                min-height: 48px;
            }

            .checkbox-item input[type="checkbox"] {
                width: 24px;
                height: 24px;
            }

            .checkbox-item label {
                font-size: 18px;
            }
        }

        /* æ‰‹æ©Ÿè£ç½® (å°æ–¼ 768px) */
        @media screen and (max-width: 768px) {
            body {
                padding: 5px;
                overflow: auto;
                height: auto;
                min-height: 100vh;
            }

            .container {
                height: auto;
                min-height: 100vh;
                border-radius: 12px;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab-button {
                flex: 1 1 100%;
                padding: 14px 12px;
                font-size: 18px;
                text-align: center;
            }

            .split-layout {
                flex-direction: column;
                overflow: visible;
            }

            .canvas-area {
                height: auto;
                min-height: 280px;
                max-height: 40vh;
            }

            .info-area {
                padding: 14px;
                overflow-y: visible;
            }

            .case-selector {
                flex-direction: column;
            }

            .case-btn {
                flex: none;
                width: 100%;
                font-size: 16px;
                padding: 14px;
            }

            .step-card p {
                font-size: 18px;
                line-height: 1.7;
            }

            .info-title {
                font-size: 20px;
            }

            .btn {
                padding: 16px 20px;
                font-size: 18px;
            }

            input[type="text"].inline-input {
                width: 80px !important;
                min-width: 70px;
                font-size: 18px;
            }

            .angle-buttons {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .angle-btn {
                padding: 14px;
                font-size: 20px;
            }

            .conclusion-card {
                padding: 24px;
                margin: 10px;
                max-width: 95%;
            }

            .conclusion-header {
                font-size: 28px;
            }

            .conclusion-content {
                font-size: 20px;
            }
        }

        /* è¶…å°è¢å¹• (å°æ–¼ 480px) */
        @media screen and (max-width: 480px) {
            .tab-button {
                padding: 12px 8px;
                font-size: 16px;
            }

            .canvas-area {
                min-height: 250px;
            }

            .step-title {
                font-size: 18px;
            }
        }

        /* è§¸æ§è£ç½®ç‰¹å®šå„ªåŒ– */
        @media (hover: none) and (pointer: coarse) {
            .btn:hover {
                transform: none;
            }

            .case-btn:hover:not(.locked) {
                background: white;
                border-color: #e9ecef;
            }

            .case-btn.active:hover {
                background: var(--secondary);
                border-color: var(--secondary);
            }

            /* å¢åŠ è§¸æ§ç›®æ¨™å¤§å° */
            .btn,
            .case-btn,
            .angle-btn,
            .checkbox-item {
                min-height: 48px;
            }

            input[type="text"].inline-input {
                min-height: 44px;
            }
        }

        /* æ©«å‘æ¨¡å¼å¹³æ¿ */
        @media screen and (min-width: 768px) and (max-width: 1024px) and (orientation: landscape) {
            .split-layout {
                flex-direction: row;
            }

            .canvas-area {
                flex: 1;
                height: 100%;
                max-height: none;
            }

            .info-area {
                flex: 1;
                border-top: none;
                border-left: 2px solid #e9ecef;
            }
        }

        /* DS-Core Injection from previous step */
        :root {
            --ds-bg: #f8fafc;
            --ds-panel: #ffffff;
            --ds-text: #1e293b;
            --ds-muted: #64748b;
            --ds-line: #e2e8f0;
            --ds-accent: #3b82f6;
            --ds-good: #10b981;
            --ds-bad: #ef4444;
            --ds-font: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", sans-serif;
            --ds-radius: 16px;
            --ds-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }

        body {
            background-color: var(--ds-bg) !important;
            color: var(--ds-text) !important;
            font-family: var(--ds-font) !important;
            line-height: normal !important;
            padding-top: 80px !important;
            display: flex !important;
            flex-direction: column !important;
            align-items: center !important;
            height: 100vh !important;
            overflow: hidden !important;
            /* Lock body, scroll inside container */
        }

        /* Global Header */
        .topbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 64px;
            background: var(--ds-panel);
            border-bottom: 1px solid var(--ds-line);
            z-index: 99999;
            display: flex;
            align-items: center;
            padding: 0 20px;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }

        .topbar__brand {
            font-weight: 700;
            font-size: 1.25rem;
            color: var(--ds-accent);
            text-decoration: none;
            margin-right: auto;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .topbar__nav {
            display: flex;
            gap: 8px;
        }

        .topbar__link {
            color: var(--ds-muted);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .topbar__link:hover {
            background: var(--ds-bg);
            color: var(--ds-text);
        }

        .topbar__link.active {
            color: var(--ds-accent);
            background: #eff6ff;
        }

        @media (max-width: 768px) {
            .topbar {
                padding: 0 12px;
            }

            .topbar__nav {
                display: none;
            }
        }

        .container {
            /* Adapt to card style */
            width: 100%;
            max-width: 95vw !important;
            height: calc(100vh - 100px) !important;
            max-height: none !important;
            background: var(--ds-panel);
            border: 1px solid var(--ds-line);
            border-radius: var(--ds-radius);
            box-shadow: var(--ds-shadow);
            overflow: hidden;
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
        }

        /* Hide old header stuff */
        .global-header {
            display: none !important;
        }
    </style>
</head>

<body>
    <header class="topbar">
        <a href="index.html" class="topbar__brand">å¹¾ä½•æ¢ç©¶å¯¦é©—å®¤</a>
        <nav class="topbar__nav">
            <a href="index.html" class="topbar__link">é¦–é </a>
            <a href="circle_explorer_fixed.html" class="topbar__link">åœ“å½¢æ¢ç©¶</a>
            <a href="circle_adventure_0104.html" class="topbar__link">è¦–è¦ºå¯¦é©—</a>
            <a href="inscribed_angle_theore_working.html" class="topbar__link active">åœ“å‘¨è§’è­‰æ˜</a>
        </nav>
    </header>

    <!-- Learning Guide Modal Removed -->

    <div class="container">
        <!-- é ç±¤å°èˆª -->
        <div class="tabs">
            <button class="tab-button active" data-tab="tab1">A. åœ“å‘¨è§’çš„ä¸è®Šæ€§</button>
            <button class="tab-button" data-tab="tab2">B. ç‰¹æ®Šè§’çš„2å€é—œä¿‚</button>
            <button class="tab-button" data-tab="tab3">C. åˆ†é¡è­‰æ˜</button>
        </div>

        <!-- Tab A: ä¸è®Šæ€§æ¢ç´¢ -->
        <div id="tab1" class="tab-content active">
            <div class="split-layout">
                <div class="canvas-area">
                    <div class="canvas-container">
                        <canvas id="canvasA"></canvas>
                    </div>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="resetTabA()">é‡è¨­ä½ç½®</button>
                        <button class="btn btn-secondary" onclick="toggleHelpers('A')">é¡¯ç¤º/éš±è—è¼”åŠ©ç·š</button>
                    </div>
                </div>
                <div class="info-area">
                    <div class="info-card">
                        <div class="info-title">ğŸ¯ æ¢ç´¢ä»»å‹™</div>
                        <p>æ‹–æ›³ P é»,è§€å¯Ÿè§’åº¦æœ‰ä»€éº¼è®ŠåŒ–?</p>
                    </div>

                    <div class="info-card">
                        <div class="info-title">ğŸ“Š å³æ™‚æ•¸æ“š</div>
                        <div class="data-row">
                            <span class="data-label">åœ“å¿ƒè§’ âˆ AOB</span>
                            <span class="data-value" id="centralAngleA">0.0Â°</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">åœ“å‘¨è§’ âˆ APB</span>
                            <span class="data-value" id="inscribedAngleA">0.0Â°</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">æ¯”å€¼ âˆ AOB Ã· âˆ APB</span>
                            <span class="data-value" id="ratioA">0.00</span>
                        </div>
                    </div>

                    <div class="explore-counter" id="exploreCounter">
                        å·²æ¢ç´¢ <span id="dragCount">0</span> æ¬¡ (æ‹–æ›³ 3 æ¬¡è§£é–è§€å¯Ÿè¨˜éŒ„)
                    </div>

                    <div class="info-card">
                        <div class="info-title">ğŸ’­ æˆ‘çš„è§€å¯Ÿ</div>
                        <div id="observationPanel" class="observation-panel">
                            <div class="question-item">
                                1. æˆ‘è§€å¯Ÿåˆ° P é»ä¸ç®¡å¦‚ä½•ç§»å‹•ï¼Œâˆ APB <br>
                                <input type="text" class="inline-input" id="obsA1" placeholder="?" style="width: 60px;">
                                ã€‚(å¡«è®Šå¤§/è®Šå°/ä¸è®Š)ï¼›<br>
                                åœ“å¿ƒè§’ âˆ AOB çš„è§’åº¦ <input type="text" class="inline-input" id="obsA2" placeholder="?"
                                    style="width: 60px;"> (å¡«è®Š/ä¸è®Š)ã€‚
                            </div>
                            <div class="question-item">
                                2. å› æ­¤å³ä½¿ P é»ä½ç½®æ”¹è®Šï¼Œä¹Ÿä¸å½±éŸ¿ âˆ APBã€âˆ AOB çš„è§’åº¦ï¼Œä½ è¦ºå¾—æ˜¯ä¾æ“š
                                <input type="text" class="inline-input" id="obsA3" placeholder="?">
                                ä¾†æ±ºå®šé€™å…©å€‹è§’çš„åº¦æ•¸ã€‚
                            </div>
                        </div>
                        <div class="hint" id="dragHint" style="margin-top: 10px; text-align: center;">âœ‹ æ‹–æ›³ P é»è‡³å°‘ 3
                            æ¬¡ä»¥è§£é–å›ç­”</div>
                    </div>

                    <button class="btn btn-locked" id="conclusionBtnA" onclick="showConclusion('A')" disabled>
                        ğŸ”’ æŸ¥çœ‹çµè«– (å®Œæˆè§€å¯Ÿå¾Œè§£é–)
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab B: ç‰¹æ®Šè§’æ¢ç´¢ -->
        <div id="tab2" class="tab-content">
            <div class="split-layout">
                <div class="canvas-area">
                    <div class="angle-buttons">
                        <button class="angle-btn" data-angle="60" onclick="setSpecialAngle(60)">60Â°</button>
                        <button class="angle-btn" data-angle="90" onclick="setSpecialAngle(90)">90Â°</button>
                        <button class="angle-btn" data-angle="120" onclick="setSpecialAngle(120)">120Â°</button>
                        <button class="angle-btn active" data-angle="180" onclick="setSpecialAngle(180)">180Â° â­</button>
                    </div>
                    <div class="canvas-container">
                        <canvas id="canvasB"></canvas>
                    </div>
                    <div class="controls">
                        <button class="btn btn-primary" onclick="resetTabB()">é‡è¨­ä½ç½®</button>
                    </div>
                </div>
                <!-- 180åº¦æŒ‰éˆ•æç¤º (å·²ç§»é™¤) -->

                <div class="info-area">
                    <div
                        style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0; font-size: 18px; color: #2C3E50;">ğŸ¯ æ¢ç´¢ä»»å‹™</h3>
                        <button class="btn btn-sm btn-outline-secondary" onclick="showTeacherHighlight()"
                            style="font-size: 12px; padding: 2px 8px;">æ•™å¸«äº®é»</button>
                    </div>

                    <div class="info-card">
                        <p style="margin-bottom: 8px;"><strong>â‘  æ‹–å‹• P é»è‡³å°‘ 3 æ¬¡ï¼Œè§€å¯Ÿï¼š</strong><br>
                            âˆ APB æœƒè®Šå—ï¼Ÿâˆ AOB æœƒè®Šå—ï¼Ÿ</p>
                        <div class="radio-group">
                            <label class="radio-item"><input type="radio" name="q1" value="all"> éƒ½è®Š</label>
                            <label class="radio-item"><input type="radio" name="q1" value="none"> éƒ½ä¸è®Š</label>
                            <label class="radio-item"><input type="radio" name="q1" value="one"> åªè®Šä¸€å€‹</label>
                        </div>

                        <div style="margin-top: 15px; margin-bottom: 8px;">
                            <strong>â‘¡ å…ˆåˆ¥çœ‹æ•¸å­—ï¼Œç”¨çœ¼ç›åˆ¤æ–·ï¼š</strong><br>
                            âˆ AOB çœ‹èµ·ä¾†ç´„æ˜¯ âˆ APB çš„ï¼Ÿ
                        </div>
                        <div class="radio-group">
                            <label class="radio-item"><input type="radio" name="q2" value="1"> 1 å€</label>
                            <label class="radio-item"><input type="radio" name="q2" value="2"> 2 å€</label>
                            <label class="radio-item"><input type="radio" name="q2" value="custom"> ä¸å›ºå®š</label>
                        </div>
                    </div>

                    <div class="info-card">
                        <p style="margin-bottom: 8px;"><strong>â‘¢ å†çœ‹æ•¸å­—ï¼Œæ› 2 å€‹ä¸åŒä½ç½®ï¼š</strong><br>
                            è¨˜ä¸‹æ¯”å€¼ âˆ AOB Ã· âˆ APB</p>
                        <div style="font-size: 14px; margin-left: 0; display: flex; flex-direction: column; gap: 8px;">
                            <div style="display: flex; align-items: center;">
                                <span
                                    style="display:inline-block; width: 60px; text-align: right; margin-right: 8px; color: #555;">ç¬¬
                                    1 æ¬¡ï¼š</span>
                                <input type="text" class="inline-input" style="flex: 1;">
                            </div>
                            <div style="display: flex; align-items: center;">
                                <span
                                    style="display:inline-block; width: 60px; text-align: right; margin-right: 8px; color: #555;">ç¬¬
                                    2 æ¬¡ï¼š</span>
                                <input type="text" class="inline-input" style="flex: 1;">
                            </div>
                        </div>
                    </div>

                    <div class="info-card" style="background: #fffdf5; border-left: 44px solid #f39c12;">
                        <p style="color: #e67e22; font-weight: bold; margin-bottom: 5px;">â‘£ æˆ‘çš„çŒœæƒ³ï¼š</p>
                        <p>åœ¨åŒä¸€å€‹åœ“ã€åŒä¸€æ®µå¼§ AB ä¸‹ï¼Œ<br>
                            âˆ AOB ç´„æ˜¯ âˆ APB çš„ <input type="text" id="guessInputB" class="inline-input"
                                style="width: 50px;"> å€ã€‚</p>
                        <hr style="border: 0; border-top: 1px solid #eee; margin: 10px 0;">
                        <p style="font-size: 12px; color: #888;">âš ï¸ æœ¬é æ˜¯ã€Œæ“ä½œè§€å¯Ÿ â†’ å½¢æˆçŒœæƒ³ã€ï¼Œå°šæœªé€²è¡Œæ•¸å­¸è­‰æ˜ã€‚</p>
                    </div>

                    <button class="btn btn-success" id="conclusionBtnB" onclick="showConclusion('B')"
                        style="margin-top: 15px; width: 100%;">æŸ¥çœ‹çµè«–</button>

                </div>
            </div>
        </div>

        <!-- Tab C: åˆ†é¡è­‰æ˜ -->
        <div id="tab3" class="tab-content">
            <div class="split-layout">
                <div class="canvas-area">
                    <div class="case-selector">
                        <button class="case-btn active" data-case="2" onclick="selectCase(2)">åœ“å¿ƒåœ¨åœ“å‘¨è§’çš„é‚Šä¸Š</button>
                        <button class="case-btn" data-case="1" onclick="selectCase(1)">åœ“å¿ƒåœ¨åœ“å‘¨è§’å…§éƒ¨</button>
                        <button class="case-btn" data-case="3" onclick="selectCase(3)"
                            style="background: linear-gradient(135deg, #f1c40f 0%, #f39c12 100%); color: #333;">ğŸ†
                            æŒ‘æˆ°é¡Œï¼šåœ“å¿ƒåœ¨åœ“å‘¨è§’å¤–éƒ¨</button>
                    </div>
                    <div class="canvas-container" style="position: relative;">
                        <canvas id="canvasC"></canvas>
                        <button class="btn btn-sm" onclick="resetTabC()" title="é‡æ–°æ•´ç†"
                            style="position: absolute; top: 10px; right: 10px; width: 32px; height: 32px; padding: 0; background: white; border: 1px solid #ddd; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 16px; display: flex; align-items: center; justify-content: center; z-index: 10; cursor: pointer; color: #555; transition: all 0.2s;">
                            ğŸ”„
                        </button>
                    </div>
                </div>
                <div class="info-area">
                    <!-- æ•™å¸«æœ‰è©±è¦èªª -->
                    <div
                        style="background: linear-gradient(135deg, #fff3cd 0%, #ffeeba 100%); border-radius: 12px; padding: 16px; margin-bottom: 16px; border-left: 4px solid #ffc107; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <span style="font-size: 24px; margin-right: 8px;">ğŸ‘©â€ğŸ«</span>
                            <span style="font-weight: bold; color: #856404; font-size: 1.1em;">æ•™å¸«æœ‰è©±è¦èªª</span>
                        </div>
                        <div style="color: #856404; line-height: 1.8; font-size: 14px;">
                            <p style="margin: 4px 0;">å‰›å‰›ä½ é€éæ‹–å‹•å’Œè§€å¯Ÿï¼Œ</p>
                            <p style="margin: 4px 0;">å·²ç¶“ç™¼ç¾è§’åº¦ä¹‹é–“å¥½åƒæœ‰å›ºå®šçš„é—œä¿‚ã€‚</p>
                            <p style="margin: 4px 0; font-weight: bold;">ç¾åœ¨ï¼Œä½ è¦è©¦è‘—ç”¨æ•¸å­¸çš„æ–¹æ³•ï¼Œä¾†è§£é‡‹é€™ä»¶äº‹ã€‚</p>
                        </div>
                    </div>

                    <!-- C-0: å¡é—œéšæ®µ -->
                    <div class="step-card active" id="stepC0">
                        <div class="step-header">
                            <div class="step-number" style="background: #e74c3c;">?</div>
                            <div class="step-title">ğŸ¤” è§€å¯Ÿèˆ‡æ€è€ƒ</div>
                        </div>
                        <div style="text-align: left; line-height: 1.8; padding: 10px 0;">
                            <p style="margin: 8px 0; font-weight: bold;">å•é¡Œï¼š</p>
                            <p style="margin: 4px 0;">åœ“å¿ƒè§’ âˆ AOB å’Œåœ“å‘¨è§’ âˆ APB ä¹‹é–“ï¼Œæœ‰ä»€éº¼é—œä¿‚ï¼Ÿ</p>
                            <p style="margin: 12px 0; color: #888; font-size: 13px;">ğŸ’­ è§€å¯Ÿåœ–å½¢ï¼Œä½ èƒ½ç™¼ç¾ä»€éº¼è¦å¾‹å—ï¼Ÿ</p>
                            <p style="margin: 12px 0; color: #888; font-size: 13px;">å¦‚æœå¡ä½äº†ï¼Œè©¦è©¦ç•«ä¸€æ¢è¼”åŠ©ç·š...</p>
                        </div>
                        <button class="btn btn-secondary" onclick="startStepC1()" style="margin-top: 8px; width: 100%;">
                            âœï¸ æˆ‘éœ€è¦ä¸€æ¢è¼”åŠ©ç·š
                        </button>
                    </div>

                    <!-- C-1: ç•«ä¸€æ¢è¼”åŠ©ç·š -->
                    <div class="step-card locked" id="stepC1" style="display: none;">
                        <div class="step-header">
                            <div class="step-number">1</div>
                            <div class="step-title">ç•«ä¸€æ¢è¼”åŠ©ç·š</div>
                        </div>
                        <div style="text-align: left; line-height: 1.8; padding: 10px 0;">
                            <p style="margin: 4px 0;">è¦æ€éº¼ç•«å‘¢?</p>
                            <div style="margin-top: 12px;">
                                <button class="btn" onclick="selectAuxLineC('OP')" id="btnAuxOP"
                                    style="width: 100%; margin-bottom: 8px; background: #f8f9fa; border: 2px solid #dee2e6; color: #495057;">
                                    é€£æ¥ O å’Œ Pï¼ˆåœ“å¿ƒåˆ°åœ“å‘¨è§’é ‚é»ï¼‰
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- C-2: ç­‰è…°çµæ§‹ -->
                    <div class="step-card locked" id="stepC2" style="display: none;">
                        <div class="step-header">
                            <div class="step-number">2</div>
                            <div class="step-title">ç™¼ç¾çµæ§‹ <span class="step-badge badge-step2">ï¼</span></div>
                        </div>
                        <div style="text-align: left; line-height: 1.8; padding: 10px 0;">
                            <p style="margin: 4px 0; font-weight: bold;">ğŸ” è§€å¯Ÿ â–³AOP å’Œ â–³BOPï¼š</p>
                            <p style="margin: 8px 0; color: #888;">æç¤ºï¼šOA, OB, OP éƒ½æ˜¯ä»€éº¼ï¼Ÿ</p>
                            <div id="c2HintArea"
                                style="display: none; margin-top: 12px; padding: 10px; background: #fff3cd; border-radius: 8px;">
                                <p style="margin: 2px 0; display: flex; align-items: center; flex-wrap: nowrap;">
                                    <span>OA = OP = OB = åœ“çš„</span>
                                    <input type="text" id="c2Input1" class="inline-input"
                                        style="width: 80px; margin: 0 4px;" oninput="checkC2Inputs()">
                                </p>
                                <p style="margin: 6px 0; display: flex; align-items: center; flex-wrap: nowrap;">
                                    <span>æ‰€ä»¥ â–³AOP å’Œ â–³BOP éƒ½æ˜¯</span>
                                    <input type="text" id="c2Input2" class="inline-input"
                                        style="width: 100px; margin: 0 4px;" oninput="checkC2Inputs()">
                                </p>
                            </div>
                            <button class="btn" onclick="showC2Hint()" id="btnC2Hint"
                                style="margin-top: 10px; width: 100%; background: #fff3cd; border: 1px solid #ffc107; color: #856404;">
                                ğŸ’¡ çœ‹æç¤º
                            </button>
                        </div>
                        <div id="c2AngleArea" style="display: none; margin-top: 12px;">
                            <p style="margin: 4px 0; font-weight: bold;">ç­‰è…°ä¸‰è§’å½¢çš„æ€§è³ªï¼š</p>
                            <div class="checkbox-item" style="margin: 8px 0;">
                                <input type="checkbox" id="checkC2a" onchange="checkC2Selection()">
                                <label for="checkC2a">âˆ OAP = âˆ OPAï¼ˆåº•è§’ç›¸ç­‰ï¼‰</label>
                            </div>
                            <div class="checkbox-item" style="margin: 8px 0;">
                                <input type="checkbox" id="checkC2b" onchange="checkC2Selection()">
                                <label for="checkC2b">âˆ OBP = âˆ OPBï¼ˆåº•è§’ç›¸ç­‰ï¼‰</label>
                            </div>
                        </div>
                    </div>

                    <!-- C-3: è¦–è¦ºæ‹¼è§’ + å¤–è§’å®šç† -->
                    <div class="step-card locked" id="stepC3" style="display: none;">
                        <div class="step-header">
                            <div class="step-number">3</div>
                            <div class="step-title">è§’åº¦é—œä¿‚ <span class="step-badge badge-step3-1">â– </span></div>
                        </div>
                        <div style="text-align: left; line-height: 1.8; padding: 10px 0;">
                            <p style="margin: 4px 0; font-weight: bold;">ğŸ§© è§€å¯Ÿè§’åº¦å¦‚ä½•ã€Œæ‹¼ã€åœ¨ä¸€èµ·ï¼š</p>
                            <p style="margin: 8px 0; color: #888;">çœ‹åœ–ä¸Šçš„å¼§ç·šï¼Œâˆ AOB æ˜¯ç”±å“ªäº›è§’çµ„æˆçš„ï¼Ÿ</p>

                            <!-- å¡«ç©ºé¡Œ ç¬¬ä¸€å±¤ -->
                            <div style="margin-top: 12px; padding: 12px; background: #e8f4f8; border-radius: 8px;">
                                <p
                                    style="margin: 4px 0; display: flex; align-items: center; flex-wrap: nowrap; font-weight: bold;">
                                    <span style="color: #e74c3c;">âˆ AOB</span>
                                    <span style="margin: 0 6px;">=</span>
                                    <span style="color: #0077b6;">âˆ </span>
                                    <input type="text" id="c3Input1" class="inline-input"
                                        style="width: 55px; margin: 0 2px; text-align: center;"
                                        oninput="checkC3Inputs()" placeholder="___">
                                    <span style="margin: 0 4px;">+</span>
                                    <span style="color: #0077b6;">âˆ </span>
                                    <input type="text" id="c3Input2" class="inline-input"
                                        style="width: 55px; margin: 0 2px; text-align: center;"
                                        oninput="checkC3Inputs()" placeholder="___">
                                </p>

                                <!-- ç¬¬äºŒå±¤ï¼šç¬¬ä¸€å±¤æ­£ç¢ºå¾Œå‡ºç¾ -->
                                <div id="c3Row2" style="display: none; margin-top: 8px;">
                                    <p
                                        style="margin: 4px 0; display: flex; align-items: center; flex-wrap: nowrap; font-weight: bold;">
                                        <span style="width: 50px;"></span>
                                        <span style="margin: 0 6px;">=</span>
                                        <span style="margin: 0 2px;">2</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Input3" class="inline-input"
                                            style="width: 55px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Inputs2()" placeholder="___">
                                        <span style="margin: 0 4px;">+</span>
                                        <span style="margin: 0 2px;">2</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Input4" class="inline-input"
                                            style="width: 55px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Inputs2()" placeholder="___">
                                    </p>
                                </div>

                                <!-- ç¬¬ä¸‰å±¤ï¼šç¬¬äºŒå±¤æ­£ç¢ºå¾Œå‡ºç¾ -->
                                <div id="c3Row3" style="display: none; margin-top: 8px;">
                                    <p
                                        style="margin: 4px 0; display: flex; align-items: center; flex-wrap: nowrap; font-weight: bold;">
                                        <span style="width: 50px;"></span>
                                        <span style="margin: 0 6px;">=</span>
                                        <span style="margin: 0 2px;">2</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Input5" class="inline-input"
                                            style="width: 55px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Inputs3()" placeholder="___">
                                    </p>
                                </div>

                                <!-- ç¬¬å››å±¤: æƒ…æ³2å°ˆç”¨ - ç¬¬ä¸‰å±¤æ­£ç¢ºå¾Œå‡ºç¾ -->
                                <div id="c3Row4Case2" style="display: none; margin-top: 8px;">
                                    <p
                                        style="margin: 4px 0; display: flex; align-items: center; flex-wrap: nowrap; font-weight: bold;">
                                        <span style="width: 50px;"></span>
                                        <span style="margin: 0 6px;">=</span>
                                        <span style="color: #e74c3c;">2âˆ APB = 180Â°</span>
                                        <span style="margin-left: 8px; color: #888;">(å¹³è§’)</span>
                                    </p>
                                    <p
                                        style="margin: 8px 0 4px 56px; font-weight: bold; color: #28a745; font-size: 1.1em;">
                                        âˆ´ âˆ APB = 90Â°
                                    </p>
                                </div>
                            </div>

                            <!-- æƒ…æ³3å°ˆç”¨è­‰æ˜å€å¡Š -->
                            <div id="c3Case3Proof"
                                style="display: none; margin-top: 12px; padding: 12px; background: #fff8e8; border-radius: 8px; border-left: 3px solid #f39c12;">
                                <p style="margin: 0 0 10px 0; font-weight: bold; color: #d35400;">ğŸ“ æƒ…æ³3ï¼šä½¿ç”¨å¤–è§’å®šç†ï¼ˆæ¸›æ³•ï¼‰</p>

                                <!-- ç¬¬ä¸€è¡Œ: âˆ DOB = âˆ OPB + âˆ OBP = 2âˆ OPB -->
                                <p
                                    style="margin: 6px 0; display: flex; align-items: center; flex-wrap: wrap; font-weight: bold;">
                                    <span style="color: #e74c3c;">âˆ DOB</span>
                                    <span style="margin: 0 4px;">=</span>
                                    <span style="color: #0077b6;">âˆ </span>
                                    <input type="text" id="c3Case3In1" class="inline-input"
                                        style="width: 50px; margin: 0 2px; text-align: center;"
                                        oninput="checkC3Case3Row1()" placeholder="___">
                                    <span style="margin: 0 2px;">+</span>
                                    <span style="color: #0077b6;">âˆ </span>
                                    <input type="text" id="c3Case3In2" class="inline-input"
                                        style="width: 50px; margin: 0 2px; text-align: center;"
                                        oninput="checkC3Case3Row1()" placeholder="___">
                                    <span style="margin: 0 2px;">=</span>
                                    <span style="margin: 0 2px;">2</span>
                                    <span style="color: #0077b6;">âˆ </span>
                                    <input type="text" id="c3Case3In3" class="inline-input"
                                        style="width: 50px; margin: 0 2px; text-align: center;"
                                        oninput="checkC3Case3Row1()" placeholder="___">
                                </p>

                                <!-- ç¬¬äºŒè¡Œ: âˆ DOA = âˆ OPA + âˆ OAP = 2âˆ OPA -->
                                <div id="c3Case3Row2" style="display: none;">
                                    <p
                                        style="margin: 6px 0; display: flex; align-items: center; flex-wrap: wrap; font-weight: bold;">
                                        <span style="color: #e74c3c;">âˆ DOA</span>
                                        <span style="margin: 0 4px;">=</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Case3In4" class="inline-input"
                                            style="width: 50px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Case3Row2()" placeholder="___">
                                        <span style="margin: 0 2px;">+</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Case3In5" class="inline-input"
                                            style="width: 50px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Case3Row2()" placeholder="___">
                                        <span style="margin: 0 2px;">=</span>
                                        <span style="margin: 0 2px;">2</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Case3In6" class="inline-input"
                                            style="width: 50px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Case3Row2()" placeholder="___">
                                    </p>
                                </div>

                                <!-- ç¬¬ä¸‰è¡Œ: âˆ AOB = âˆ DOB - âˆ DOA -->
                                <div id="c3Case3Row3" style="display: none;">
                                    <p
                                        style="margin: 10px 0 6px 0; display: flex; align-items: center; flex-wrap: wrap; font-weight: bold;">
                                        <span style="color: #e74c3c;">âˆ AOB</span>
                                        <span style="margin: 0 4px;">=</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Case3In7" class="inline-input"
                                            style="width: 50px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Case3Row3()" placeholder="___">
                                        <span style="margin: 0 4px; color: #e74c3c; font-size: 1.2em;">âˆ’</span>
                                        <span style="color: #0077b6;">âˆ </span>
                                        <input type="text" id="c3Case3In8" class="inline-input"
                                            style="width: 50px; margin: 0 2px; text-align: center;"
                                            oninput="checkC3Case3Row3()" placeholder="___">
                                    </p>
                                </div>

                                <!-- ç¬¬å››è¡Œ: = 2âˆ OPB - 2âˆ OPA = 2âˆ APB -->
                                <div id="c3Case3Row4" style="display: none;">
                                    <p
                                        style="margin: 6px 0 6px 56px; display: flex; align-items: center; flex-wrap: wrap; font-weight: bold;">
                                        <span style="margin: 0 4px;">=</span>
                                        <span>2âˆ OPB âˆ’ 2âˆ OPA</span>
                                    </p>
                                    <p
                                        style="margin: 6px 0 6px 56px; display: flex; align-items: center; flex-wrap: wrap; font-weight: bold; color: #28a745; font-size: 1.1em;">
                                        <span style="margin: 0 4px;">=</span>
                                        <span>2âˆ APB</span>
                                        <span style="margin-left: 10px;">âœ“</span>
                                    </p>
                                </div>
                            </div>

                            <!-- ç­”æ¡ˆæ­£ç¢ºå¾Œé¡¯ç¤º -->
                            <div id="c3TheoremArea" style="display: none; margin-top: 12px;">
                                <p
                                    style="margin: 4px 0; padding: 10px; background: #ffe0e0; border-radius: 8px; text-align: center;">
                                    ğŸ“ é€™å°±æ˜¯<strong style="color: #e74c3c;">ã€Œä¸‰è§’å½¢å¤–è§’å®šç†ã€</strong>ï¼
                                </p>
                                <button class="btn btn-success" onclick="completeC3()"
                                    style="margin-top: 10px; width: 100%;">
                                    âœ“ æˆ‘ç†è§£äº†ï¼
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- C-4: çµè«– + æ•™å¸«äº®é» -->
                    <div class="step-card locked" id="stepC4" style="display: none;">
                        <div class="step-header">
                            <div class="step-number" style="background: #2ecc71;">âœ“</div>
                            <div class="step-title">ğŸ¯ ç™¼ç¾çµè«–</div>
                        </div>
                        <div style="text-align: left; line-height: 1.8; padding: 10px 0;">
                            <p style="margin: 4px 0;">ä»£å…¥ç­‰è…°ä¸‰è§’å½¢çš„ç­‰è§’ï¼š</p>
                            <div style="padding: 10px; background: #f0fff0; border-radius: 8px; margin: 10px 0;">
                                <p style="margin: 2px 0;">âˆ AOB = (âˆ OAP + âˆ OPA) + (âˆ OBP + âˆ OPB)</p>
                                <p style="margin: 2px 0; padding-left: 40px;">= 2âˆ OPA + 2âˆ OPB</p>
                                <p style="margin: 2px 0; padding-left: 40px;">= 2(âˆ OPA + âˆ OPB)</p>
                                <p
                                    style="margin: 8px 0; padding-left: 40px; font-size: 18px; font-weight: bold; color: #2ecc71;">
                                    = 2 Ã— âˆ APB</p>
                            </div>
                            <div
                                style="padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 10px; text-align: center; color: white; margin: 15px 0;">
                                <p style="margin: 0; font-size: 16px; font-weight: bold;">ğŸ“ åœ“å¿ƒè§’ = 2 Ã— åœ“å‘¨è§’</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- çµè«–æµ®å‹•å¡ç‰‡ -->
    <div class="conclusion-overlay" id="conclusionOverlay">
        <div class="conclusion-card">
            <div class="conclusion-header" id="conclusionHeader"></div>
            <div class="conclusion-content" id="conclusionContent"></div>
            <button class="btn btn-primary" onclick="closeConclusion()" style="width: 100%;">æˆ‘ç†è§£äº†</button>
        </div>
    </div>

    <script>
        // ===== å…¨åŸŸè®Šæ•¸ =====
        let state = {
            tabA: {
                dragCount: 0,
                observationUnlocked: false,
                conclusionUnlocked: false,
                showHelpers: true
            },
            tabB: {
                currentAngle: 180,
                completedRatios: new Set(),
                showHelpers: true
            },
            tabC: {
                currentCase: 2,
                proofStep: 0, // æ–°å¢é€²åº¦ç‹€æ…‹ 0~3
                step1Complete: false,
                step2Complete: false,
                step3Complete: false,
                auxiliaryDrawn: false,
                showHelpers: true
            }
        };

        // Canvas è¨­å®š
        const canvases = {
            A: null,
            B: null,
            C: null
        };

        const contexts = {
            A: null,
            B: null,
            C: null
        };

        // å¹¾ä½•åƒæ•¸
        const geometry = {
            A: { center: null, radius: 0, pointA: null, pointB: null, pointP: null, dragging: false },
            B: { center: null, radius: 0, pointA: null, pointB: null, pointP: null, dragging: false },
            C: {
                center: null, radius: 0, pointA: null, pointB: null, pointP: null, dragging: false
            }
        };

        // Tab C å°ˆç”¨æ¨£å¼æ˜ å°„
        const C_ANNOT_STYLE = {
            auxiliary: { color: '#9b59b6', symbol: 'Â·Â·Â·' },    // ç´«è‰²
            isosceles: { color: '#e67e22', symbol: 'ï¼' },     // æ©˜è‰²
            inscribed: { color: '#2ecc71', symbol: 'â—' },     // ç¶ è‰²
            central: { color: '#e74c3c', symbol: 'â– ' }      // ç´…è‰²
        };

        // Tab C Badge æ¨£å¼
        const tabCStyles = document.createElement('style');
        tabCStyles.textContent = `
            #tab3 .step-badge {
                display: inline-block;
                padding: 2px 6px;
                border-radius: 4px;
                font-size: 12px;
                font-weight: bold;
                margin-left: 6px;
                color: white;
                min-width: 18px;
                text-align: center;
                opacity: 0.35; /* é è¨­åŠé€æ˜ */
                transition: opacity 0.3s;
            }
            #tab3 .step-card.completed .step-badge,
            #tab3 .step-card.active .step-badge {
                opacity: 1; /* å®Œæˆæˆ–é€²è¡Œä¸­å‰‡ä¸é€æ˜ */
            }
            #tab3 .badge-step1 { background-color: ${C_ANNOT_STYLE.auxiliary.color}; }
            #tab3 .badge-step2 { background-color: ${C_ANNOT_STYLE.isosceles.color}; }
            #tab3 .badge-step3-1 { background-color: ${C_ANNOT_STYLE.central.color}; }
            #tab3 .badge-step3-2 { background-color: ${C_ANNOT_STYLE.inscribed.color}; }
        `;
        document.head.appendChild(tabCStyles);

        // å‹•ç•«å¹€
        let animationFrameId = null;
        let isDrawing = false;

        // ===== åˆå§‹åŒ– =====
        window.addEventListener('DOMContentLoaded', function () {
            // åˆå§‹åŒ–æ‰€æœ‰ tab
            setTimeout(() => {
                initTab('A');
                initTab('B');
                initTab('C');
            }, 100);

            // é ç±¤åˆ‡æ›
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.dataset.tab;
                    switchTab(tabId);
                });
            });

            // Tab B å¡«ç©ºç›£è½
            ['ratio60', 'ratio90', 'ratio120', 'ratio180'].forEach(id => {
                const elem = document.getElementById(id);
                if (elem) {
                    elem.addEventListener('input', checkTabBCompletion);
                }
            });
        });

        function initTab(tab) {
            const canvas = document.getElementById(`canvas${tab}`);
            if (!canvas) {
                console.error(`Canvas${tab} not found!`);
                return;
            }

            canvases[tab] = canvas;
            contexts[tab] = canvas.getContext('2d');

            resizeCanvas(tab);
            window.addEventListener('resize', () => resizeCanvas(tab));

            // æ»‘é¼ /è§¸æ§äº‹ä»¶
            canvas.addEventListener('mousedown', (e) => handleStart(tab, e));
            canvas.addEventListener('mousemove', (e) => handleMove(tab, e));
            canvas.addEventListener('mouseup', () => handleEnd(tab));
            canvas.addEventListener('mouseleave', () => handleEnd(tab));

            canvas.addEventListener('touchstart', (e) => handleStart(tab, e.touches[0]));
            canvas.addEventListener('touchmove', (e) => { e.preventDefault(); handleMove(tab, e.touches[0]); });
            canvas.addEventListener('touchend', () => handleEnd(tab));

            initGeometry(tab);
            draw(tab);
        }

        function resizeCanvas(tab) {
            const canvas = canvases[tab];
            if (!canvas) {
                console.error(`Canvas ${tab} not available for resize`);
                return;
            }

            const container = canvas.parentElement;
            if (!container) {
                console.error(`Container for canvas ${tab} not found`);
                return;
            }

            // å–å®¹å™¨çš„å¯¦éš›å°ºå¯¸
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;

            // ä½¿ç”¨è¼ƒå°çš„é‚Šä½œç‚ºæ­£æ–¹å½¢é‚Šé•·,ä¸¦ç•™å‡ºä¸€äº› padding
            const size = Math.min(containerWidth, containerHeight) * 0.95;

            console.log(`Resizing canvas ${tab}: container ${containerWidth}x${containerHeight}, canvas ${size}x${size}`);

            if (size > 0) {
                // è¨­å®š canvas å¯¦éš›åƒç´ å°ºå¯¸(ç¹ªè£½è§£æåº¦)
                canvas.width = size;
                canvas.height = size;

                // è¨­å®š canvas é¡¯ç¤ºå°ºå¯¸(CSS)
                canvas.style.width = size + 'px';
                canvas.style.height = size + 'px';

                initGeometry(tab);
                draw(tab);
            }
        }

        function initGeometry(tab) {
            const canvas = canvases[tab];

            if (tab === 'B') {
                // Revert to ScaleFactor approach for stability
                // 0.47 scale = 0.94 diameter (Filling 94% of shortest side)
                const sFactor = 0.47;
                const r = Math.min(canvas.width, canvas.height) * sFactor;

                // Center with slight vertical offset for top labels
                geometry[tab].center = {
                    x: canvas.width / 2,
                    y: canvas.height * 0.53
                };
                geometry[tab].radius = r * 0.8; // ç¸®å° 20%
            } else {
                // Tab A, C ç¶­æŒåŸæœ‰é‚è¼¯ (åŸºæ–¼ canvas WIDTH å±¬æ€§)
                const centerX = canvas.width / 2;
                const centerY = canvas.height / 2;
                const scaleFactor = 0.42;
                const radius = Math.min(canvas.width, canvas.height) * scaleFactor;

                geometry[tab].center = { x: centerX, y: centerY };
                geometry[tab].radius = radius;
            }

            // è¨­å®š A, B é»åº§æ¨™
            if (tab === 'B') {
                setPointsForAngle(state.tabB.currentAngle);
            } else {
                // Tab A, C: å›ºå®šå¼§ AB
                const r = geometry[tab].radius;
                const cx = geometry[tab].center.x;
                const cy = geometry[tab].center.y;

                // Tab C Case 2: åœ“å¿ƒåœ¨åœ“å‘¨è§’çš„é‚Šä¸Š (P å’Œ B åœ¨ç›´å¾‘å…©ç«¯)
                if (tab === 'C' && state.tabC.currentCase === 2) {
                    // A åœ¨å·¦ä¸Šæ–¹
                    geometry[tab].pointA = {
                        x: cx - r * Math.cos(Math.PI / 4),
                        y: cy - r * Math.sin(Math.PI / 4)
                    };
                    // B åœ¨å³ä¸‹æ–¹
                    geometry[tab].pointB = {
                        x: cx + r * Math.cos(Math.PI / 4),
                        y: cy + r * Math.sin(Math.PI / 4)
                    };
                    // P åœ¨å·¦æ–¹ (PB é€šéåœ“å¿ƒ O)
                    geometry[tab].pointP = {
                        x: cx - r,
                        y: cy
                    };
                }
                // Tab C Case 3: åœ“å¿ƒåœ¨åœ“å‘¨è§’å¤–éƒ¨
                else if (tab === 'C' && state.tabC.currentCase === 3) {
                    // A åœ¨å³ä¸Šæ–¹ (ç´„1-2é»é˜æ–¹å‘)
                    geometry[tab].pointA = {
                        x: cx + r * Math.cos(Math.PI / 5),
                        y: cy - r * Math.sin(Math.PI / 5)
                    };
                    // B åœ¨å³ä¸­ä¸‹æ–¹ (ç´„4é»é˜æ–¹å‘)
                    geometry[tab].pointB = {
                        x: cx + r * Math.cos(Math.PI / 4),
                        y: cy + r * Math.sin(Math.PI / 4)
                    };
                    // P åœ¨å·¦ä¸‹æ–¹ (ç´„7-8é»é˜æ–¹å‘ï¼Œåœ“å¿ƒ O åœ¨ âˆ APB å¤–éƒ¨)
                    geometry[tab].pointP = {
                        x: cx - r * Math.cos(Math.PI / 4),
                        y: cy + r * Math.sin(Math.PI / 4)
                    };
                } else {
                    // åŸæœ‰é‚è¼¯ (Case 1 å’Œ Tab A)
                    geometry[tab].pointA = {
                        x: cx - r * Math.cos(Math.PI / 6),
                        y: cy - r * Math.sin(Math.PI / 6)
                    };
                    geometry[tab].pointB = {
                        x: cx + r * Math.cos(Math.PI / 6),
                        y: cy - r * Math.sin(Math.PI / 6)
                    };
                }
            }

            // P é»åˆå§‹ä½ç½®
            if (tab === 'C' && (state.tabC.currentCase === 2 || state.tabC.currentCase === 3)) {
                // Case 2 & 3: P å·²åœ¨ä¸Šé¢è¨­å®š
            } else {
                // æ­£ä¸‹æ–¹(åœ¨å„ªå¼§ä¸Š)
                geometry[tab].pointP = {
                    x: geometry[tab].center.x,
                    y: geometry[tab].center.y + geometry[tab].radius
                };
            }
        }

        function setPointsForAngle(angleDeg) {
            const angleRad = angleDeg * Math.PI / 180;
            const cx = geometry.B.center.x;
            const cy = geometry.B.center.y;
            const r = geometry.B.radius;

            // ä»¥æ­£ä¸Šæ–¹ç‚ºåŸºæº–ï¼Œå·¦å³å„å angle/2
            const base = -Math.PI / 2;
            const t1 = base - angleRad / 2;
            const t2 = base + angleRad / 2;

            geometry.B.pointA = { x: cx + r * Math.cos(t1), y: cy + r * Math.sin(t1) };
            geometry.B.pointB = { x: cx + r * Math.cos(t2), y: cy + r * Math.sin(t2) };

            // P é»åˆå§‹åœ¨ä¸‹æ–¹ï¼ˆåœ¨å¼§ä¸Šï¼‰
            geometry.B.pointP = { x: cx, y: cy + r };
        }

        // ===== ç¹ªåœ–å‡½æ•¸ =====
        function draw(tab) {
            // Tab B è‡ªæ•‘æ©Ÿåˆ¶: é¿å…å¹¾ä½•æœªåˆå§‹åŒ–
            if (tab === 'B' && (!geometry.B || !geometry.B.radius || geometry.B.radius < 20 || isNaN(geometry.B.radius))) {
                initGeometry('B');
                setPointsForAngle(state.tabB.currentAngle || 180);
            }

            const ctx = contexts[tab];
            const canvas = canvases[tab];
            const g = geometry[tab];

            if (!ctx || !canvas || !g || !g.center) {
                console.error(`Cannot draw tab ${tab}: missing resources`);
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // ç¹ªè£½åœ“
            ctx.beginPath();
            ctx.arc(g.center.x, g.center.y, g.radius, 0, Math.PI * 2);

            if (tab === 'B') {
                // Tab B: é»‘è‰²ç·šæ¢ï¼Œå–®å±¤
                ctx.strokeStyle = '#000000';
                ctx.lineWidth = 3;
            } else {
                ctx.strokeStyle = '#dee2e6';
                ctx.lineWidth = 3;
            }
            ctx.stroke();

            // ç¹ªè£½åœ“å¿ƒè§’æ‰‡å½¢
            if (tab === 'B') {
                // Tab B: æ»¿ç‰ˆæ‰‡å½¢ (Full Radius), ä»¿ç…§åœ–ç¤ºçš„ç²‰ç´…å¡«è‰²
                drawVisibleAngleArc(ctx, g.center, g.pointA, g.pointB, g.radius, '#FFB6C1', 0.35);
            } else {
                drawAngleArc(ctx, g.center, g.pointA, g.pointB, g.radius, '#FF6B6B', 0.2);
            }

            // ç¹ªè£½åœ“å‘¨è§’
            if (tab === 'B') {
                // Tab B: é’è‰²å¡«è‰²
                drawVisibleAngleArc(ctx, g.pointP, g.pointA, g.pointB, g.radius * 0.15, '#20C997', 0.3);
            } else {
                drawAngleArc(ctx, g.pointP, g.pointA, g.pointB, 60, '#4ECDC4', 0.3);
            }

            // ç¹ªè£½åŠå¾‘ OA, OB
            const tabState = state[`tab${tab}`];
            // Tab B: ä¸ç¹ªè£½æ˜é¡¯çš„åŠå¾‘ç·šæ¢ (ç”±æ‰‡å½¢å¡«è‰²é‚Šç•Œå‘ˆç¾)ï¼Œåƒ… Aã€C ç¹ªè£½
            if (tab !== 'B' && ((tabState && tabState.showHelpers !== false) || tab === 'C')) {
                drawLine(ctx, g.center, g.pointA, '#adb5bd', 2);
                drawLine(ctx, g.center, g.pointB, '#adb5bd', 2);
            }

            // ç¹ªè£½å¼¦ AB (Tab C ä¸ç¹ªè£½)
            if (tab !== 'C') {
                drawLine(ctx, g.pointA, g.pointB, '#495057', 3);
            }

            // ç¹ªè£½åœ“å‘¨è§’çš„é‚Š (Tab B ä½¿ç”¨é’è‰², ç¨å¾®åŠ ç²—)
            if (tab === 'B') {
                drawLine(ctx, g.pointP, g.pointA, '#20C997', 3);
                drawLine(ctx, g.pointP, g.pointB, '#20C997', 3);
            } else {
                drawLine(ctx, g.pointP, g.pointA, '#4ECDC4', 3);
                drawLine(ctx, g.pointP, g.pointB, '#4ECDC4', 3);
            }



            // Tab C: åˆ†æ­¥é©Ÿæ¨™è¨»æ¸²æŸ“
            if (tab === 'C') {
                const step = state.tabC.proofStep;

                // è¨ˆç®— OP å»¶é•·ç·šèˆ‡åœ“çš„äº¤é» D (åœ¨å¼§ AB ä¸Šï¼ŒP çš„å°é¢)
                const Ax = g.pointA.x, Ay = g.pointA.y;
                const Bx = g.pointB.x, By = g.pointB.y;
                const Ox = g.center.x, Oy = g.center.y;
                const Px = g.pointP.x, Py = g.pointP.y;

                // æ–¹å‘å‘é‡ OP
                const dx = Px - Ox;
                const dy = Py - Oy;

                // D æ˜¯ P é—œæ–¼åœ“å¿ƒ O çš„å°ç¨±é» (åœ¨åœ“ä¸Šï¼Œèˆ‡ P ç›´å¾‘å°ç¨±)
                const pointD = {
                    x: Ox - (Px - Ox),
                    y: Oy - (Py - Oy)
                };

                // Proof Step >= 1: ç•« OP è¼”åŠ©ç·šä¸¦å»¶é•·è‡³åœ“ä¸Šçš„ D é»
                if (step >= 1) {
                    // ç•« OP è™›ç·š (ç´«è‰²)
                    drawLine(ctx, g.center, g.pointP, C_ANNOT_STYLE.auxiliary.color, 4, [5, 5]);

                    // ç•« OD å»¶é•·æ®µ (å¾ O åˆ° D)
                    drawLine(ctx, g.center, pointD, C_ANNOT_STYLE.auxiliary.color, 4, [5, 5]);

                    // æ¨™ç¤º D é»
                    drawPoint(ctx, pointD, 'D', C_ANNOT_STYLE.auxiliary.color, 5);

                    // æ¨™ç¤ºæ–‡å­— "OP" (ç´„åœ¨ä¸­é»åç§»)
                    const midX = (g.center.x + g.pointP.x) / 2;
                    const midY = (g.center.y + g.pointP.y) / 2;
                    ctx.save();
                    ctx.fillStyle = C_ANNOT_STYLE.auxiliary.color;
                    ctx.font = 'bold 14px Arial';
                    // åç§»é‡èª¿æ•´ï¼Œé¿å…è¢«ç·šæ¢æ“‹ä½
                    ctx.fillText('OP', midX - 25, midY - 5);
                    ctx.restore();
                }

                // æª¢æŸ¥å‹¾é¸ç‹€æ…‹ (å³æ™‚åé¥‹) - ä½¿ç”¨æ–°çš„æ¢ç©¶å¼éšæ®µ checkbox ID
                const checkC2a = document.getElementById('checkC2a') && document.getElementById('checkC2a').checked;
                const checkC2b = document.getElementById('checkC2b') && document.getElementById('checkC2b').checked;

                // Step 2: æ¨™è¨˜ç­‰è…° (æ©˜è‰²åˆ»ç—• + ç´…/è—è§’åº¦æ¨™è¨˜)
                if (step >= 2 || checkC2a) {
                    drawEqualMarks(ctx, g.center, g.pointA, g.center, g.pointP, C_ANNOT_STYLE.isosceles.color);
                    drawDotAngle(ctx, g.pointA, g.center, g.pointP, '#FF6B6B');
                    drawDotAngle(ctx, g.pointP, g.center, g.pointA, '#FF6B6B');
                }
                if (step >= 2 || checkC2b) {
                    drawEqualMarks(ctx, g.center, g.pointB, g.center, g.pointP, C_ANNOT_STYLE.isosceles.color);
                    drawDotAngle(ctx, g.pointB, g.center, g.pointP, '#4ECDC4');
                    drawDotAngle(ctx, g.pointP, g.center, g.pointB, '#4ECDC4');
                }

                // Step 3: å¤–è§’å®šç†æç¤º - å»¶é•·ç®­é ­ + ç´…è‰²å¤–è§’æç¤º
                if (step >= 3 && pointD) {
                    // ç•«å»¶é•·ç®­é ­ (å¾ D å‘å¤–å»¶ä¼¸)
                    const extLen = 20;
                    const extDx = (Px - Ox) / Math.sqrt(dx * dx + dy * dy);
                    const extDy = (Py - Oy) / Math.sqrt(dx * dx + dy * dy);
                    const arrowEnd = { x: pointD.x + extDx * extLen, y: pointD.y + extDy * extLen };

                    ctx.save();
                    ctx.strokeStyle = C_ANNOT_STYLE.central.color;
                    ctx.lineWidth = 3;
                    ctx.setLineDash([]);
                    ctx.beginPath();
                    ctx.moveTo(pointD.x, pointD.y);
                    ctx.lineTo(arrowEnd.x, arrowEnd.y);
                    ctx.stroke();

                    // ç®­é ­é ­éƒ¨
                    const arrowSize = 8;
                    const angle = Math.atan2(extDy, extDx);
                    ctx.beginPath();
                    ctx.moveTo(arrowEnd.x, arrowEnd.y);
                    ctx.lineTo(arrowEnd.x - arrowSize * Math.cos(angle - 0.4), arrowEnd.y - arrowSize * Math.sin(angle - 0.4));
                    ctx.lineTo(arrowEnd.x - arrowSize * Math.cos(angle + 0.4), arrowEnd.y - arrowSize * Math.sin(angle + 0.4));
                    ctx.closePath();
                    ctx.fillStyle = C_ANNOT_STYLE.central.color;
                    ctx.fill();
                    ctx.restore();
                }

                // Step 4: å–®ä¸€å¼§ç·šè¡¨ç¤º âˆ AOB (ç´…) å’Œ âˆ APB (ç¶ )
                if (step >= 4) {
                    // âˆ AOB ç´…è‰²å¼§
                    drawAngleArc(ctx, g.center, g.pointA, g.pointB, 45, C_ANNOT_STYLE.central.color, 0.4);

                    // âˆ APB ç¶ è‰²å¼§
                    drawAngleArc(ctx, g.pointP, g.pointA, g.pointB, 35, C_ANNOT_STYLE.inscribed.color, 0.4);
                }
            }

            // Tab B: 180Â° æ™‚é¡¯ç¤ºç›´è§’ç¬¦è™Ÿ
            if (tab === 'B' && state.tabB.currentAngle === 180) {
                drawRightAngle(ctx, g.pointP, g.pointA, g.pointB, 20);
            }

            // ç¹ªè£½é»
            if (tab === 'C') {
                const ptSize = 6;
                drawPoint(ctx, g.center, 'O', '#0077b6', ptSize);
                drawPoint(ctx, g.pointA, 'A', '#FF6B6B', ptSize);
                drawPoint(ctx, g.pointB, 'B', '#FF6B6B', ptSize);

                // è¨ˆç®— P é»æ¨™ç±¤åç§» (å‘å¤–)
                const dx = g.pointP.x - g.center.x;
                const dy = g.pointP.y - g.center.y;
                const len = Math.sqrt(dx * dx + dy * dy);
                const defaultOffset = 30; // è·é›¢é»ä¸­å¿ƒçš„è·é›¢
                const offX = (len > 0) ? (dx / len) * defaultOffset : 0;
                const offY = (len > 0) ? (dy / len) * defaultOffset : 25;

                drawPoint(ctx, g.pointP, 'P', '#20C997', ptSize, { x: offX, y: offY });
            } else {
                drawPoint(ctx, g.center, 'O', '#0077b6');
                drawPoint(ctx, g.pointA, 'A', '#FF6B6B');
                drawPoint(ctx, g.pointB, 'B', '#FF6B6B');
                drawPoint(ctx, g.pointP, 'P', '#20C997');
            }

            // æ›´æ–°æ•¸æ“šé¡¯ç¤º
            updateData(tab);

            // Tab B: ç¹ªè£½è§’åº¦æ¨™ç±¤ (åœ¨ updateData å¾Œç¢ºä¿ç¢ºå¯¦è¨ˆç®—ï¼Œä¹Ÿå¯åœ¨æ­¤é‡ç®—)
            if (tab === 'B') {
                const CA = calculateAngle(g.center, g.pointA, g.pointB);
                const IA = calculateAngle(g.pointP, g.pointA, g.pointB);

                // åœ“å¿ƒè§’æ¨™ç±¤ (å·²éš±è—)
                // drawAngleLabel(ctx, g.center, g.pointA, g.pointB, `âˆ AOB = ${CA.toFixed(0)}Â°`, '#FF6B6B', 40);

                // åœ“å‘¨è§’æ¨™ç±¤ (å·²éš±è—)
                // drawAngleLabel(ctx, g.pointP, g.pointA, g.pointB, `âˆ APB = ${IA.toFixed(0)}Â°`, '#4ECDC4', 70);
            }
        }

        function drawLine(ctx, p1, p2, color, width, dash = []) {
            ctx.beginPath();
            ctx.moveTo(p1.x, p1.y);
            ctx.lineTo(p2.x, p2.y);
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.setLineDash(dash);
            ctx.stroke();
            ctx.setLineDash([]);
        }

        function drawPoint(ctx, point, label, color, radius = 10, textOffset = { x: 0, y: -18 }) {
            ctx.beginPath();
            ctx.arc(point.x, point.y, radius, 0, Math.PI * 2);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.strokeStyle = 'white';
            ctx.lineWidth = 3;
            ctx.stroke();

            ctx.fillStyle = color;
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            // å¦‚æœæä¾›äº† textOffsetï¼Œå‰‡ä½¿ç”¨å®ƒï¼›å¦å‰‡é»˜èªç‚º y-18
            // é€™è£¡é‚è¼¯ä¿®æ”¹ç‚ºï¼šå‚³å…¥çš„ textOffset æ˜¯ç›¸å°æ–¼é»çš„ä½ç§»
            // ç‚ºäº†å…¼å®¹èˆŠçš„èª¿ç”¨ (æ²’æœ‰å‚³ textOffset)ï¼Œé»˜èªå€¼è¨­ç‚º {x:0, y:-18} æ˜¯åˆé©çš„
            // ä½†æˆ‘çš„ä¸Šæ–¹ switch-tab é‚è¼¯ä¸­ï¼Œé‡å° Tab C P å‚³å…¥äº†è‡ªè¨‚å€¼

            // æ³¨æ„ï¼šfillText çš„ä½ç½®
            ctx.fillText(label, point.x + textOffset.x, point.y + textOffset.y);
        }

        function drawAngleArc(ctx, vertex, p1, p2, radius, color, alpha) {
            const angle1 = Math.atan2(p1.y - vertex.y, p1.x - vertex.x);
            const angle2 = Math.atan2(p2.y - vertex.y, p2.x - vertex.x);

            ctx.beginPath();
            ctx.moveTo(vertex.x, vertex.y);
            ctx.arc(vertex.x, vertex.y, radius, angle1, angle2);
            ctx.closePath();
            ctx.fillStyle = color + Math.round(alpha * 255).toString(16).padStart(2, '0');
            ctx.fill();
        }

        function drawVisibleAngleArc(ctx, vertex, p1, p2, radius, color, alpha) {
            let angle1 = Math.atan2(p1.y - vertex.y, p1.x - vertex.x);
            let angle2 = Math.atan2(p2.y - vertex.y, p2.x - vertex.x);

            // Normalize to minor arc
            let diff = angle2 - angle1;
            if (diff < 0) diff += 2 * Math.PI;
            if (diff > Math.PI) {
                const temp = angle1;
                angle1 = angle2;
                angle2 = temp;
                if (angle2 < angle1) angle2 += 2 * Math.PI;
            }

            ctx.beginPath();
            ctx.moveTo(vertex.x, vertex.y);
            ctx.arc(vertex.x, vertex.y, radius, angle1, angle2);
            ctx.closePath();
            ctx.fillStyle = color + Math.round(alpha * 255).toString(16).padStart(2, '0');
            ctx.fill();

            // Stroke arc
            ctx.beginPath();
            ctx.arc(vertex.x, vertex.y, radius, angle1, angle2);
            ctx.strokeStyle = color;
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawAngleLabel(ctx, vertex, p1, p2, text, color, offsetRadius) {
            let vx = (p1.x - vertex.x) + (p2.x - vertex.x);
            let vy = (p1.y - vertex.y) + (p2.y - vertex.y);
            let len = Math.sqrt(vx * vx + vy * vy);

            if (len < 1e-5) {
                vx = 0; vy = -1;
            } else {
                vx /= len; vy /= len;
            }

            const lx = vertex.x + vx * offsetRadius;
            const ly = vertex.y + vy * offsetRadius;

            ctx.save();
            ctx.font = "bold 14px Arial";
            const metric = ctx.measureText(text);
            const w = metric.width + 10;
            const h = 24;

            ctx.fillStyle = "rgba(255,255,255,0.9)";
            ctx.shadowColor = "rgba(0,0,0,0.2)";
            ctx.shadowBlur = 4;
            ctx.beginPath();
            if (ctx.roundRect) {
                ctx.roundRect(lx - w / 2, ly - h / 2, w, h, 6);
            } else {
                ctx.rect(lx - w / 2, ly - h / 2, w, h);
            }
            ctx.fill();

            ctx.fillStyle = color;
            ctx.textAlign = "center";
            ctx.textBaseline = "middle";
            ctx.fillText(text, lx, ly);
            ctx.restore();
        }

        function drawRightAngle(ctx, vertex, p1, p2, size) {
            const v1x = p1.x - vertex.x;
            const v1y = p1.y - vertex.y;
            const v2x = p2.x - vertex.x;
            const v2y = p2.y - vertex.y;

            const len1 = Math.sqrt(v1x * v1x + v1y * v1y);
            const len2 = Math.sqrt(v2x * v2x + v2y * v2y);

            const ux1 = v1x / len1 * size;
            const uy1 = v1y / len1 * size;
            const ux2 = v2x / len2 * size;
            const uy2 = v2y / len2 * size;

            ctx.beginPath();
            ctx.moveTo(vertex.x + ux1, vertex.y + uy1);
            ctx.lineTo(vertex.x + ux1 + ux2, vertex.y + uy1 + uy2);
            ctx.lineTo(vertex.x + ux2, vertex.y + uy2);
            ctx.strokeStyle = '#4ECDC4';
            ctx.lineWidth = 2;
            ctx.stroke();
        }

        function drawEqualMarks(ctx, p1, p2, p3, p4, color = '#F39C12') {
            // åœ¨ç·šæ®µä¸­é»ç•«åˆ»ç—•æ¨™è¨˜ç›¸ç­‰
            const mid1 = { x: (p1.x + p2.x) / 2, y: (p1.y + p2.y) / 2 };
            const mid2 = { x: (p3.x + p4.x) / 2, y: (p3.y + p4.y) / 2 };

            const drawMark = (mid, dx, dy) => {
                const perpX = -dy;
                const perpY = dx;
                const len = Math.sqrt(perpX * perpX + perpY * perpY);
                const ux = perpX / len * 8;
                const uy = perpY / len * 8;

                ctx.beginPath();
                ctx.moveTo(mid.x - ux, mid.y - uy);
                ctx.lineTo(mid.x + ux, mid.y + uy);
                ctx.strokeStyle = color;
                ctx.lineWidth = 3;
                ctx.stroke();
            };

            drawMark(mid1, p2.x - p1.x, p2.y - p1.y);
            drawMark(mid2, p4.x - p3.x, p4.y - p3.y);
        }

        // ===== äº’å‹•è™•ç† =====
        function handleStart(tab, e) {
            const rect = canvases[tab].getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // è¨ˆç®—ç›¸å°æ–¼ canvas å…§éƒ¨çš„åº§æ¨™
            const canvas = canvases[tab];
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const canvasX = x * scaleX;
            const canvasY = y * scaleY;

            const dist = distance({ x: canvasX, y: canvasY }, geometry[tab].pointP);
            if (dist < 30) {  // å¢åŠ åµæ¸¬ç¯„åœ
                geometry[tab].dragging = true;
            }
        }

        function handleMove(tab, e) {
            if (!geometry[tab].dragging) return;

            const rect = canvases[tab].getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;

            // è¨ˆç®—ç›¸å°æ–¼ canvas å…§éƒ¨çš„åº§æ¨™
            const canvas = canvases[tab];
            const scaleX = canvas.width / rect.width;
            const scaleY = canvas.height / rect.height;

            const canvasX = x * scaleX;
            const canvasY = y * scaleY;

            // è¨ˆç®—å‘é‡
            const dx = canvasX - geometry[tab].center.x;
            const dy = canvasY - geometry[tab].center.y;
            const dist = Math.sqrt(dx * dx + dy * dy);

            // åš´æ ¼é™åˆ¶ P åœ¨åœ“ä¸Š(æ­¸ä¸€åŒ–åˆ°åŠå¾‘)
            if (dist > 0) {
                let newPx = geometry[tab].center.x + (dx / dist) * geometry[tab].radius;
                let newPy = geometry[tab].center.y + (dy / dist) * geometry[tab].radius;

                // Tab C Case 3: é™åˆ¶ P ä¸èƒ½è¶Šé OA çš„å»¶é•·ç·š
                if (tab === 'C' && state.tabC.currentCase === 3) {
                    const O = geometry[tab].center;
                    const A = geometry[tab].pointA;
                    const B = geometry[tab].pointB;

                    // è¨ˆç®— OA å‘é‡
                    const oaX = A.x - O.x;
                    const oaY = A.y - O.y;

                    // è¨ˆç®—æ–° P ä½ç½®ç›¸å°æ–¼ O çš„å‘é‡
                    const opX = newPx - O.x;
                    const opY = newPy - O.y;

                    // ä½¿ç”¨å‰ç©åˆ¤æ–· P åœ¨ OA çš„å“ªä¸€å´
                    // æ­£å€¼è¡¨ç¤º P åœ¨ OA çš„å·¦å´ï¼ˆé€†æ™‚é‡æ–¹å‘ï¼‰
                    const crossOA = oaX * opY - oaY * opX;

                    // è¨ˆç®— OB å‘é‡
                    const obX = B.x - O.x;
                    const obY = B.y - O.y;

                    // P å¿…é ˆä¿æŒåœ¨ OB çš„åŒä¸€å´ï¼ˆç›¸å°æ–¼ OAï¼‰
                    // è¨ˆç®— B åœ¨ OA çš„å“ªä¸€å´
                    const crossOA_B = oaX * obY - oaY * obX;

                    // å¦‚æœ P å’Œ B ä¸åœ¨ OA çš„åŒä¸€å´ï¼Œå‰‡å°‡ P é™åˆ¶åœ¨ A é»é™„è¿‘
                    if (crossOA * crossOA_B < 0) {
                        // P è¶Šéäº† OA ç·šï¼Œå°‡ P è¨­å›é è¿‘ A çš„ä½ç½®
                        const angleA = Math.atan2(A.y - O.y, A.x - O.x);
                        // ç¨å¾®åé›¢ A çš„è§’åº¦
                        const offset = crossOA_B > 0 ? 0.05 : -0.05;
                        newPx = O.x + geometry[tab].radius * Math.cos(angleA + offset);
                        newPy = O.y + geometry[tab].radius * Math.sin(angleA + offset);
                    }
                }

                geometry[tab].pointP = { x: newPx, y: newPy };
            }

            // ä½¿ç”¨ requestAnimationFrame å„ªåŒ–ç¹ªåœ–
            if (!isDrawing) {
                isDrawing = true;
                animationFrameId = requestAnimationFrame(() => {
                    draw(tab);
                    isDrawing = false;
                });
            }
        }

        function handleEnd(tab) {
            if (geometry[tab].dragging) {
                geometry[tab].dragging = false;

                if (tab === 'A') {
                    state.tabA.dragCount++;
                    document.getElementById('dragCount').textContent = state.tabA.dragCount;

                    if (state.tabA.dragCount >= 3 && !state.tabA.observationUnlocked) {
                        state.tabA.observationUnlocked = true;
                        document.getElementById('observationPanel').classList.add('unlocked');
                        document.getElementById('dragHint').style.display = 'none';

                        // Add listeners to new inputs
                        ['obsA1', 'obsA2', 'obsA3'].forEach(id => {
                            document.getElementById(id).addEventListener('input', checkTabACompletion);
                        });
                    }
                }
            }
        }

        function distance(p1, p2) {
            return Math.sqrt((p1.x - p2.x) ** 2 + (p1.y - p2.y) ** 2);
        }

        // ===== æ•¸æ“šæ›´æ–° =====
        function updateData(tab) {
            const g = geometry[tab];

            // è¨ˆç®—åœ“å¿ƒè§’
            const centralAngle = calculateAngle(g.center, g.pointA, g.pointB);

            // è¨ˆç®—åœ“å‘¨è§’
            const inscribedAngle = calculateAngle(g.pointP, g.pointA, g.pointB);

            // è¨ˆç®—æ¯”å€¼
            const ratio = centralAngle / inscribedAngle;

            if (tab === 'A') {
                document.getElementById('centralAngleA').textContent = centralAngle.toFixed(1) + 'Â°';
                document.getElementById('inscribedAngleA').textContent = inscribedAngle.toFixed(1) + 'Â°';
                document.getElementById('ratioA').textContent = ratio.toFixed(2);
            } else if (tab === 'B') {
                // No specific data display elements for Tab B in the new structure,
                // but the angles are still calculated for drawing labels.
            }
        }

        function calculateAngle(vertex, p1, p2) {
            const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };
            const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };

            const dot = v1.x * v2.x + v1.y * v2.y;
            const cross = v1.x * v2.y - v1.y * v2.x;

            let angle = Math.atan2(cross, dot);
            if (angle < 0) angle += Math.PI * 2;

            return angle * 180 / Math.PI;
        }

        // ===== Tab A åŠŸèƒ½ =====
        function resetTabA() {
            state.tabA.dragCount = 0;
            document.getElementById('dragCount').textContent = '0';
            initGeometry('A');
            draw('A');
        }

        function toggleHelpers(tab) {
            const tabKey = `tab${tab}`;
            if (state[tabKey]) {
                state[tabKey].showHelpers = !state[tabKey].showHelpers;
                draw(tab);
            }
        }

        function checkTabACompletion() {
            const obs1 = document.getElementById('obsA1').value.trim();
            const obs2 = document.getElementById('obsA2').value.trim();
            const obs3 = document.getElementById('obsA3').value.trim();

            if (obs1 && obs2 && obs3) {
                state.tabA.conclusionUnlocked = true;
                const btn = document.getElementById('conclusionBtnA');
                btn.classList.remove('btn-locked');
                btn.classList.add('btn-success');
                btn.disabled = false;
                btn.innerHTML = 'âœ¨ æŸ¥çœ‹çµè«–';
            }
        }

        // ===== Tab B åŠŸèƒ½ =====
        function setSpecialAngle(angle) {
            state.tabB.currentAngle = angle;

            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            document.querySelectorAll('.angle-btn').forEach(btn => {
                btn.classList.remove('active');
                if (parseInt(btn.dataset.angle) === angle) {
                    btn.classList.add('active');
                }
            });

            setPointsForAngle(angle);
            draw('B');
        }

        function resetTabB() {
            initGeometry('B');
            draw('B');
        }

        function checkTabBCompletion() {
            // This function is no longer relevant for the new Tab B content,
            // but keeping it as a placeholder or removing it if not needed.
            // The new Tab B doesn't have 'ratio60', 'ratio90', etc.
            // For now, it will just do nothing or throw errors if elements are missing.
            // If the new inputs need validation, this function would need to be rewritten.
        }

        // ===== Tab C åŠŸèƒ½ (æ¢ç©¶å¼å››éšæ®µ) =====
        function selectCase(caseNum) {
            console.log('selectCase called with:', caseNum);
            state.tabC.currentCase = caseNum;
            state.tabC.proofStep = 0;
            resetTabC();
            document.querySelectorAll('.case-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.case-btn[data-case="${caseNum}"]`).classList.add('active');
            console.log('currentCase is now:', state.tabC.currentCase);
        }

        function resetTabC() {
            state.tabC.proofStep = 0;
            state.tabC.step1Complete = false;
            state.tabC.step2Complete = false;
            state.tabC.step3Complete = false;
            state.tabC.auxiliaryDrawn = false;

            // é‡ç½®æ‰€æœ‰éšæ®µå¡ç‰‡
            const stepC0 = document.getElementById('stepC0');
            const stepC1 = document.getElementById('stepC1');
            const stepC2 = document.getElementById('stepC2');
            const stepC3 = document.getElementById('stepC3');
            const stepC4 = document.getElementById('stepC4');

            if (stepC0) { stepC0.className = 'step-card active'; stepC0.style.display = 'block'; }
            if (stepC1) { stepC1.className = 'step-card locked'; stepC1.style.display = 'none'; }
            if (stepC2) { stepC2.className = 'step-card locked'; stepC2.style.display = 'none'; }
            if (stepC3) { stepC3.className = 'step-card locked'; stepC3.style.display = 'none'; }
            if (stepC4) { stepC4.className = 'step-card locked'; stepC4.style.display = 'none'; }

            // é‡ç½®æç¤ºå€åŸŸ
            const c2Hint = document.getElementById('c2HintArea');
            const c2Angle = document.getElementById('c2AngleArea');
            const c3Visual = document.getElementById('c3VisualArea');
            const c3Theorem = document.getElementById('c3TheoremArea');
            const btnC2 = document.getElementById('btnC2Hint');
            const btnC3 = document.getElementById('btnC3Visual');

            if (c2Hint) c2Hint.style.display = 'none';
            if (c2Angle) c2Angle.style.display = 'none';
            if (c3Visual) c3Visual.style.display = 'none';
            if (c3Theorem) c3Theorem.style.display = 'none';
            if (btnC2) btnC2.style.display = 'block';
            if (btnC3) btnC3.style.display = 'block';

            // é‡ç½®å¡«ç©ºè¡Œ
            const c3Row2 = document.getElementById('c3Row2');
            const c3Row3 = document.getElementById('c3Row3');
            const c3Row4Case2 = document.getElementById('c3Row4Case2');
            const c3Case3Proof = document.getElementById('c3Case3Proof');
            const c3Case3Row2 = document.getElementById('c3Case3Row2');
            const c3Case3Row3 = document.getElementById('c3Case3Row3');
            const c3Case3Row4 = document.getElementById('c3Case3Row4');

            if (c3Row2) c3Row2.style.display = 'none';
            if (c3Row3) c3Row3.style.display = 'none';
            if (c3Row4Case2) c3Row4Case2.style.display = 'none';
            if (c3Case3Proof) c3Case3Proof.style.display = 'none';
            if (c3Case3Row2) c3Case3Row2.style.display = 'none';
            if (c3Case3Row3) c3Case3Row3.style.display = 'none';
            if (c3Case3Row4) c3Case3Row4.style.display = 'none';

            // æ¸…é™¤å¡«ç©ºè¼¸å…¥æ¡† (åŒ…å«æƒ…æ³3çš„è¼¸å…¥æ¡†)
            ['c3Input1', 'c3Input2', 'c3Input3', 'c3Input4', 'c3Input5', 'c2Input1', 'c2Input2',
                'c3Case3In1', 'c3Case3In2', 'c3Case3In3', 'c3Case3In4', 'c3Case3In5', 'c3Case3In6',
                'c3Case3In7', 'c3Case3In8'].forEach(id => {
                    const inp = document.getElementById(id);
                    if (inp) {
                        inp.value = '';
                        inp.style.borderColor = '#0077b6';
                        inp.style.background = '#fff';
                    }
                });

            // æ¸…é™¤ checkbox
            document.querySelectorAll('#tab3 input[type="checkbox"]').forEach(cb => cb.checked = false);

            initGeometry('C');
            draw('C');
        }

        // C-0 â†’ C-1: é»æ“Šã€Œæˆ‘éœ€è¦ä¸€æ¢è¼”åŠ©ç·šã€
        function startStepC1() {
            document.getElementById('stepC0').style.display = 'none';
            document.getElementById('stepC1').style.display = 'block';
            document.getElementById('stepC1').className = 'step-card active';
        }

        // C-1 â†’ C-2: é¸æ“‡è¼”åŠ©ç·š OP
        function selectAuxLineC(lineType) {
            if (lineType === 'OP') {
                state.tabC.auxiliaryDrawn = true;
                state.tabC.step1Complete = true;
                state.tabC.proofStep = 1;

                document.getElementById('stepC1').className = 'step-card completed';
                document.getElementById('stepC2').style.display = 'block';
                document.getElementById('stepC2').className = 'step-card active';

                document.getElementById('btnAuxOP').style.background = '#d4edda';
                document.getElementById('btnAuxOP').style.borderColor = '#28a745';

                draw('C');
            }
        }

        // C-2: é¡¯ç¤ºç­‰è…°æç¤º (å¡«ç©ºå€)
        function showC2Hint() {
            document.getElementById('c2HintArea').style.display = 'block';
            document.getElementById('btnC2Hint').style.display = 'none';
            // è§’åº¦å€åŸŸç­‰å¡«ç©ºæ­£ç¢ºå¾Œå†é¡¯ç¤º
        }

        // C-2: æª¢æŸ¥å¡«ç©ºè¼¸å…¥æ˜¯å¦æ­£ç¢º
        function checkC2Inputs() {
            const input1 = document.getElementById('c2Input1');
            const input2 = document.getElementById('c2Input2');
            if (!input1 || !input2) return;

            const val1 = input1.value.trim();
            const val2 = input2.value.trim();

            // é©—è­‰ç­”æ¡ˆ (æ”¾å¯¬æ¥å—æ¢ä»¶)
            const ans1Correct = (val1 === 'åŠå¾‘' || val1 === 'r' || val1 === 'R' || val1 === 'radius' || val1.includes('åŠå¾‘'));
            const ans2Correct = (val2 === 'ç­‰è…°ä¸‰è§’å½¢' || val2 === 'ç­‰è…°' || val2.includes('ç­‰è…°'));

            // è¦–è¦ºåé¥‹
            if (val1.length > 0) {
                input1.style.borderColor = ans1Correct ? '#28a745' : '#dc3545';
                input1.style.background = ans1Correct ? '#d4edda' : '#fff';
            } else {
                input1.style.borderColor = '#ffc107';
                input1.style.background = '#fff';
            }

            if (val2.length > 0) {
                input2.style.borderColor = ans2Correct ? '#28a745' : '#dc3545';
                input2.style.background = ans2Correct ? '#d4edda' : '#fff';
            } else {
                input2.style.borderColor = '#ffc107';
                input2.style.background = '#fff';
            }

            // å…©å€‹éƒ½æ­£ç¢ºæ™‚é¡¯ç¤ºè§’åº¦å€åŸŸå’ŒæˆåŠŸè¨Šæ¯
            if (ans1Correct && ans2Correct) {
                const angleArea = document.getElementById('c2AngleArea');
                if (angleArea) {
                    angleArea.style.display = 'block';
                }
                state.tabC.proofStep = Math.max(state.tabC.proofStep, 2);
                draw('C');
            }
        }

        // C-2: æª¢æŸ¥è§’åº¦ checkbox
        function checkC2Selection() {
            const a = document.getElementById('checkC2a').checked;
            const b = document.getElementById('checkC2b').checked;

            draw('C');

            if (a && b) {
                state.tabC.step2Complete = true;
                document.getElementById('stepC2').className = 'step-card completed';
                document.getElementById('stepC3').style.display = 'block';
                document.getElementById('stepC3').className = 'step-card active';

                // æƒ…æ³3: é¡¯ç¤ºå°ˆå±¬è­‰æ˜å€å¡Šï¼Œéš±è—é€šç”¨å€å¡Š
                if (state.tabC.currentCase === 3) {
                    document.getElementById('c3Case3Proof').style.display = 'block';
                    // éš±è—é€šç”¨çš„å¡«ç©ºå€å¡Š
                    const regularProof = document.querySelector('#stepC3 > div > div:nth-child(3)');
                    if (regularProof && regularProof.style) {
                        regularProof.style.display = 'none';
                    }
                }
            }
        }

        // C-3: æª¢æŸ¥ç¬¬ä¸€å±¤å¡«ç©º (âˆ AOB = âˆ AOP + âˆ BOP æˆ– âˆ AOD + âˆ BOD)
        function checkC3Inputs() {
            const input1 = document.getElementById('c3Input1');
            const input2 = document.getElementById('c3Input2');
            if (!input1 || !input2) return;

            let val1 = input1.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val2 = input2.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');

            // æœ‰æ•ˆç­”æ¡ˆ: AOP, POA, AOD, DOA, BOP, POB, BOD, DOB
            const aopGroup = ['AOP', 'POA', 'AOD', 'DOA'];
            const bopGroup = ['BOP', 'POB', 'BOD', 'DOB'];
            const validAngles = [...aopGroup, ...bopGroup];

            const isAOP = aopGroup.includes(val1);
            const isBOP = bopGroup.includes(val1);
            const isAOP2 = aopGroup.includes(val2);
            const isBOP2 = bopGroup.includes(val2);

            const ans1Valid = validAngles.includes(val1);
            const ans2Valid = validAngles.includes(val2);
            const bothCorrect = ((isAOP && isBOP2) || (isBOP && isAOP2));

            // è¦–è¦ºåé¥‹
            if (val1.length > 0) {
                input1.style.borderColor = ans1Valid ? '#28a745' : '#dc3545';
                input1.style.background = ans1Valid ? '#d4edda' : '#fff';
            } else {
                input1.style.borderColor = '#0077b6';
                input1.style.background = '#fff';
            }

            if (val2.length > 0) {
                input2.style.borderColor = ans2Valid ? '#28a745' : '#dc3545';
                input2.style.background = ans2Valid ? '#d4edda' : '#fff';
            } else {
                input2.style.borderColor = '#0077b6';
                input2.style.background = '#fff';
            }

            // ç¬¬ä¸€å±¤æ­£ç¢ºæ™‚é¡¯ç¤ºç¬¬äºŒå±¤
            if (bothCorrect) {
                const row2 = document.getElementById('c3Row2');
                if (row2) row2.style.display = 'block';
            }
        }

        // C-3: æª¢æŸ¥ç¬¬äºŒå±¤å¡«ç©º (= 2âˆ OPA + 2âˆ OPB)
        function checkC3Inputs2() {
            const input3 = document.getElementById('c3Input3');
            const input4 = document.getElementById('c3Input4');
            if (!input3 || !input4) return;

            let val3 = input3.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val4 = input4.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');

            // æœ‰æ•ˆç­”æ¡ˆ: OPA, APO, OPB, BPO
            const opaGroup = ['OPA', 'APO', 'PAO', 'OAP'];
            const opbGroup = ['OPB', 'BPO', 'PBO', 'OBP'];
            const validAngles = [...opaGroup, ...opbGroup];

            const isOPA = opaGroup.includes(val3);
            const isOPB = opbGroup.includes(val3);
            const isOPA2 = opaGroup.includes(val4);
            const isOPB2 = opbGroup.includes(val4);

            const ans3Valid = validAngles.includes(val3);
            const ans4Valid = validAngles.includes(val4);
            const bothCorrect = ((isOPA && isOPB2) || (isOPB && isOPA2));

            // è¦–è¦ºåé¥‹
            if (val3.length > 0) {
                input3.style.borderColor = ans3Valid ? '#28a745' : '#dc3545';
                input3.style.background = ans3Valid ? '#d4edda' : '#fff';
            } else {
                input3.style.borderColor = '#0077b6';
                input3.style.background = '#fff';
            }

            if (val4.length > 0) {
                input4.style.borderColor = ans4Valid ? '#28a745' : '#dc3545';
                input4.style.background = ans4Valid ? '#d4edda' : '#fff';
            } else {
                input4.style.borderColor = '#0077b6';
                input4.style.background = '#fff';
            }

            // ç¬¬äºŒå±¤æ­£ç¢ºæ™‚é¡¯ç¤ºç¬¬ä¸‰å±¤
            if (bothCorrect) {
                const row3 = document.getElementById('c3Row3');
                if (row3) row3.style.display = 'block';
            }
        }

        // C-3: æª¢æŸ¥ç¬¬ä¸‰å±¤å¡«ç©º (= 2âˆ APB)
        function checkC3Inputs3() {
            const input5 = document.getElementById('c3Input5');
            if (!input5) return;

            let val5 = input5.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');

            // æœ‰æ•ˆç­”æ¡ˆ: APB, BPA
            const validAngles = ['APB', 'BPA'];
            const isCorrect = validAngles.includes(val5);

            // è¦–è¦ºåé¥‹
            if (val5.length > 0) {
                input5.style.borderColor = isCorrect ? '#28a745' : '#dc3545';
                input5.style.background = isCorrect ? '#d4edda' : '#fff';
            } else {
                input5.style.borderColor = '#0077b6';
                input5.style.background = '#fff';
            }

            // ç­”æ¡ˆæ­£ç¢ºæ™‚
            if (isCorrect) {
                // æƒ…æ³2: é¡¯ç¤ºç‰¹æ®Šçµè«– (2âˆ APB = 180Â°, âˆ APB = 90Â°)
                if (state.tabC.currentCase === 2) {
                    const row4 = document.getElementById('c3Row4Case2');
                    if (row4) row4.style.display = 'block';
                }

                document.getElementById('c3TheoremArea').style.display = 'block';
                state.tabC.proofStep = Math.max(state.tabC.proofStep, 3);
                draw('C');
            }
        }

        // ä¿ç•™èˆŠå‡½æ•¸ (å·²ä¸ä½¿ç”¨)
        function showC3Visual() {
            checkC3Inputs();
        }

        // ===== æƒ…æ³3å°ˆç”¨é©—è­‰å‡½æ•¸ =====
        // ç¬¬ä¸€è¡Œ: âˆ DOB = âˆ OPB + âˆ OBP = 2âˆ OPB
        function checkC3Case3Row1() {
            const in1 = document.getElementById('c3Case3In1');
            const in2 = document.getElementById('c3Case3In2');
            const in3 = document.getElementById('c3Case3In3');
            if (!in1 || !in2 || !in3) return;

            let val1 = in1.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val2 = in2.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val3 = in3.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');

            // âˆ DOB çš„å…©å€‹å…§è§’: OPB/BPO å’Œ OBP/PBO
            const opbGroup = ['OPB', 'BPO', 'PBO', 'OBP'];
            const obpGroup = ['OBP', 'PBO', 'OPB', 'BPO'];

            const is1Valid = opbGroup.includes(val1) || obpGroup.includes(val1);
            const is2Valid = opbGroup.includes(val2) || obpGroup.includes(val2);
            // çµæœå¿…é ˆæ˜¯ OPB
            const is3Valid = ['OPB', 'BPO'].includes(val3);

            // è¦–è¦ºåé¥‹
            [in1, in2, in3].forEach((inp, idx) => {
                const val = [val1, val2, val3][idx];
                const valid = [is1Valid, is2Valid, is3Valid][idx];
                if (val.length > 0) {
                    inp.style.borderColor = valid ? '#28a745' : '#dc3545';
                    inp.style.background = valid ? '#d4edda' : '#fff';
                } else {
                    inp.style.borderColor = '#0077b6';
                    inp.style.background = '#fff';
                }
            });

            // å…¨éƒ¨æ­£ç¢ºæ™‚é¡¯ç¤ºç¬¬äºŒè¡Œ
            if (is1Valid && is2Valid && is3Valid) {
                document.getElementById('c3Case3Row2').style.display = 'block';
            }
        }

        // ç¬¬äºŒè¡Œ: âˆ DOA = âˆ OPA + âˆ OAP = 2âˆ OPA
        function checkC3Case3Row2() {
            const in4 = document.getElementById('c3Case3In4');
            const in5 = document.getElementById('c3Case3In5');
            const in6 = document.getElementById('c3Case3In6');
            if (!in4 || !in5 || !in6) return;

            let val4 = in4.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val5 = in5.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val6 = in6.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');

            // âˆ DOA çš„å…©å€‹å…§è§’: OPA/APO å’Œ OAP/PAO
            const opaGroup = ['OPA', 'APO', 'PAO', 'OAP'];
            const oapGroup = ['OAP', 'PAO', 'OPA', 'APO'];

            const is4Valid = opaGroup.includes(val4) || oapGroup.includes(val4);
            const is5Valid = opaGroup.includes(val5) || oapGroup.includes(val5);
            // çµæœå¿…é ˆæ˜¯ OPA
            const is6Valid = ['OPA', 'APO'].includes(val6);

            // è¦–è¦ºåé¥‹
            [in4, in5, in6].forEach((inp, idx) => {
                const val = [val4, val5, val6][idx];
                const valid = [is4Valid, is5Valid, is6Valid][idx];
                if (val.length > 0) {
                    inp.style.borderColor = valid ? '#28a745' : '#dc3545';
                    inp.style.background = valid ? '#d4edda' : '#fff';
                } else {
                    inp.style.borderColor = '#0077b6';
                    inp.style.background = '#fff';
                }
            });

            // å…¨éƒ¨æ­£ç¢ºæ™‚é¡¯ç¤ºç¬¬ä¸‰è¡Œ
            if (is4Valid && is5Valid && is6Valid) {
                document.getElementById('c3Case3Row3').style.display = 'block';
            }
        }

        // ç¬¬ä¸‰è¡Œ: âˆ AOB = âˆ DOB - âˆ DOA
        function checkC3Case3Row3() {
            const in7 = document.getElementById('c3Case3In7');
            const in8 = document.getElementById('c3Case3In8');
            if (!in7 || !in8) return;

            let val7 = in7.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');
            let val8 = in8.value.trim().toUpperCase().replace(/âˆ /g, '').replace(/\s/g, '');

            // æ­£ç¢ºç­”æ¡ˆ: DOB å’Œ DOA (æˆ– BOD å’Œ AOD)
            const dobGroup = ['DOB', 'BOD'];
            const doaGroup = ['DOA', 'AOD'];

            const is7Valid = dobGroup.includes(val7);
            const is8Valid = doaGroup.includes(val8);

            // è¦–è¦ºåé¥‹
            if (val7.length > 0) {
                in7.style.borderColor = is7Valid ? '#28a745' : '#dc3545';
                in7.style.background = is7Valid ? '#d4edda' : '#fff';
            } else {
                in7.style.borderColor = '#0077b6';
                in7.style.background = '#fff';
            }

            if (val8.length > 0) {
                in8.style.borderColor = is8Valid ? '#28a745' : '#dc3545';
                in8.style.background = is8Valid ? '#d4edda' : '#fff';
            } else {
                in8.style.borderColor = '#0077b6';
                in8.style.background = '#fff';
            }

            // å…¨éƒ¨æ­£ç¢ºæ™‚é¡¯ç¤ºçµè«–ä¸¦å®Œæˆ
            if (is7Valid && is8Valid) {
                document.getElementById('c3Case3Row4').style.display = 'block';
                document.getElementById('c3TheoremArea').style.display = 'block';
                state.tabC.proofStep = Math.max(state.tabC.proofStep, 3);
                draw('C');
            }
        }

        // C-3 â†’ C-4: å®Œæˆå¤–è§’å®šç†ç†è§£
        function completeC3() {
            state.tabC.step3Complete = true;
            state.tabC.proofStep = 4;

            document.getElementById('stepC3').className = 'step-card completed';
            document.getElementById('stepC4').style.display = 'block';
            document.getElementById('stepC4').className = 'step-card active';

            draw('C');
        }

        // ä¿ç•™èˆŠå‡½æ•¸ä»¥é˜²å…¶ä»–åœ°æ–¹èª¿ç”¨
        function drawAuxiliaryLine() { selectAuxLineC('OP'); }
        function checkStep2() { }
        function checkStep2C() { checkC2Selection(); }
        function completeStep3() { }
        function completeStep3C() { completeC3(); }
        function showTeacherInsight() { }

        // æ–°å¢: ç•«é»ç‹€è§’åº¦æ¨™è¨˜
        function drawDotAngle(ctx, vertex, p1, p2, color) {
            // è¨ˆç®—è§’å¹³åˆ†ç·šæ–¹å‘
            let v1x = p1.x - vertex.x;
            let v1y = p1.y - vertex.y;
            const len1 = Math.sqrt(v1x * v1x + v1y * v1y);
            v1x /= len1; v1y /= len1;

            let v2x = p2.x - vertex.x;
            let v2y = p2.y - vertex.y;
            const len2 = Math.sqrt(v2x * v2x + v2y * v2y);
            v2x /= len2; v2y /= len2;

            let mx = v1x + v2x;
            let my = v1y + v2y;
            const mlen = Math.sqrt(mx * mx + my * my);

            if (mlen > 0) {
                mx /= mlen; my /= mlen;
                const r = 25; // è·é›¢é ‚é»çš„è·é›¢

                ctx.beginPath();
                ctx.arc(vertex.x + mx * r, vertex.y + my * r, 5, 0, Math.PI * 2); // åŠå¾‘5çš„ç©ºå¿ƒåœ“
                ctx.strokeStyle = color;
                ctx.lineWidth = 2.5;
                ctx.stroke();
            }
        }

        // æ–°å¢: ç•«é›™åœˆè§’åº¦æ¨™è¨˜ (ä»£è¡¨ 2 å€é—œä¿‚)
        function drawDoubleDotAngle(ctx, vertex, p1, p2, color) {
            // è¨ˆç®—è§’å¹³åˆ†ç·šæ–¹å‘
            let v1x = p1.x - vertex.x;
            let v1y = p1.y - vertex.y;
            const len1 = Math.sqrt(v1x * v1x + v1y * v1y);
            v1x /= len1; v1y /= len1;

            let v2x = p2.x - vertex.x;
            let v2y = p2.y - vertex.y;
            const len2 = Math.sqrt(v2x * v2x + v2y * v2y);
            v2x /= len2; v2y /= len2;

            let mx = v1x + v2x;
            let my = v1y + v2y;
            const mlen = Math.sqrt(mx * mx + my * my);

            if (mlen > 0) {
                mx /= mlen; my /= mlen;
                const r = 30; // è·é›¢é ‚é»çš„è·é›¢

                // ç•«å…©å€‹ä¸¦æ’çš„ç©ºå¿ƒåœ“
                ctx.beginPath();
                ctx.arc(vertex.x + mx * r - 6, vertex.y + my * r, 5, 0, Math.PI * 2);
                ctx.strokeStyle = color;
                ctx.lineWidth = 2.5;
                ctx.stroke();

                ctx.beginPath();
                ctx.arc(vertex.x + mx * r + 6, vertex.y + my * r, 5, 0, Math.PI * 2);
                ctx.strokeStyle = color;
                ctx.lineWidth = 2.5;
                ctx.stroke();
            }
        }

        // ===== çµè«–é¡¯ç¤º =====
        function showConclusion(tab) {
            const overlay = document.getElementById('conclusionOverlay');
            const header = document.getElementById('conclusionHeader');
            const content = document.getElementById('conclusionContent');

            overlay.classList.add('active');

            if (tab === 'A') {
                header.innerHTML = 'ğŸ‰ æ­å–œç™¼ç¾ï¼';
                content.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: #20c997; margin-bottom: 10px;">åœ“å‘¨è§’çš„ä¸è®Šæ€§</h3>
                        <p style="font-size: 1.1em; line-height: 1.6;">
                            ç•¶åœ“å¿ƒè§’å›ºå®šæ™‚ï¼Œ<br>
                            åŒä¸€æ®µå¼§æ‰€å°çš„åœ“å‘¨è§’<br>
                            <strong style="color: #FF6B6B; font-size: 1.2em;">æ°¸é ç›¸ç­‰</strong>
                        </p>
                    </div>
                    <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.95em;">
                        é€™å°±æ˜¯è‘—åçš„<strong>ã€ŒåŒå¼§æ‰€å°åœ“å‘¨è§’ç›¸ç­‰ã€</strong>æ€§è³ªã€‚<br>
                        æ¥ä¸‹ä¾†ï¼Œæˆ‘å€‘è¦çœ‹çœ‹åœ“å‘¨è§’å’Œåœ“å¿ƒè§’ä¹‹é–“æœ‰ä»€éº¼é—œä¿‚ï¼
                    </div>
                `;
            } else if (tab === 'B') {
                const guessInput = document.getElementById('guessInputB');
                const val = parseFloat(guessInput ? guessInput.value : 0);

                // é¡¯ç¤º Toast å›é¥‹
                const toast = document.createElement('div');
                toast.id = 'bToast';
                toast.style.cssText = 'position:fixed; right:24px; bottom:24px; z-index:9999; background:rgba(0,0,0,0.8); color:white; padding:12px 24px; border-radius:8px; font-size:14px; transition:opacity 0.5s; box-shadow:0 4px 12px rgba(0,0,0,0.2);';

                if (val >= 1.8 && val <= 2.2) {
                    toast.textContent = 'ä½ çš„çŒœæ¸¬æ²’æœ‰éŒ¯å–”ï¼æ¥ä¸‹ä¾†æˆ‘å€‘é€²å…¥æ•¸å­¸è­‰æ˜å§ã€‚';
                    toast.style.background = '#20c997'; // Success color
                } else {
                    toast.textContent = 'å†æ‹–å‹• P é»å¤šè©¦å¹¾æ¬¡ï¼Œçœ‹çœ‹æ¯”å€¼æ˜¯å¦ç©©å®šã€‚';
                    toast.style.background = '#f39c12'; // Warning color
                }

                document.body.appendChild(toast);
                setTimeout(() => {
                    toast.style.opacity = '0';
                    setTimeout(() => toast.remove(), 500);
                }, 2500);

                header.innerHTML = 'âœ¨ çŒœæƒ³é©—è­‰';
                content.innerHTML = `
                    <div style="text-align: center; margin-bottom: 20px;">
                        <h3 style="color: #FF6B6B; margin-bottom: 10px;">2 å€è§’é—œä¿‚</h3>
                        <p style="font-size: 1.1em; line-height: 1.6;">
                            ä½ è§€å¯Ÿåˆ°çš„è¦å¾‹æ˜¯å°çš„ï¼<br>
                            <strong style="color: #20c997; font-size: 1.2em;">åœ“å¿ƒè§’ = 2 Ã— åœ“å‘¨è§’</strong>
                        </p>
                    </div>
                    <div style="background: #fffdf5; padding: 15px; border-radius: 8px; border-left: 4px solid #f39c12; font-size: 0.95em;">
                        âš ï¸ ä½†è«‹æ³¨æ„ï¼š<br>
                        é€™ç›®å‰åªæ˜¯é€éæ¸¬é‡ç™¼ç¾çš„ã€Œç¶“é©—è¦å¾‹ã€ã€‚<br>
                        ä¸€å®šè¦ç¶“éæ•¸å­¸è­‰æ˜ï¼Œæ‰èƒ½ç¢ºå®šé€™æ˜¯æ°¸é æˆç«‹çš„å®šç†ã€‚<br>
                        <br>
                        æº–å‚™å¥½é€²è¡Œè­‰æ˜äº†å—ï¼Ÿ
                    </div>
                `;
            }
        }

        function showTeacherHighlight() {
            alert("ã€Œå®ƒä¸æ˜¯åœ¨æ•™å®šç†ï¼Œ\nè€Œæ˜¯åœ¨è®“å­¸ç”Ÿã€ç™¼ç¾ä¸€å€‹ç„¡æ³•ç”©æ‰çš„é—œä¿‚ã€ã€‚ã€");
        }

        function closeConclusion() {
            document.getElementById('conclusionOverlay').classList.remove('active');
        }

        // ===== é ç±¤åˆ‡æ› =====
        function switchTab(tabId) {
            document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[data-tab="${tabId}"]`).classList.add('active');
            document.getElementById(tabId).classList.add('active');

            // é‡æ–°ç¹ªè£½ç•¶å‰ tab (éœ€é‡æ–°èª¿æ•´å¤§å°ä»¥ä¿®æ­£éš±è— tab çš„å°ºå¯¸å•é¡Œ)
            const tabLetter = tabId.replace('tab', '');
            resizeCanvas(tabLetter);
        }
    </script>
</body>

</html>